@{
    ViewBag.Title = "Auto Charge";
    Layout = "~/Views/Shared/Layout/Fo_ReportLayout.cshtml";
    
}
<script src="../../Scripts/xlExport.js"></script>
<div class="content-wrapper">
    <section class=" col-xl-12 col-md-12 col-sm-12 themedes p-0 ">
        <link href="../../Content/Contribute.css" rel="stylesheet" />
        <link href="../../Content/bootstrap-4.4.1-dist/css/bootstrap.min.css" rel="stylesheet" />
        <link href="~/Content/sidemenu-webix.css" rel="stylesheet" />
        <link href="~/FO/CSS/sidemenu-custom.css" rel="stylesheet" />
        <link href="../../Content/xlExportCss.css" rel="stylesheet" />
        <div class="container-fluid">

            <div class="row new_hdr" id="divHeader">
                <div class="col-sm-3">

                    <div class="TextWidth" id="divPropbox">
                    </div>
                </div>
                <div class="col-sm-5 text-center">
                    <label class="wc_hdr_tlt" id="lblRptCaption">Auto Charge </label>

                </div>
                <div class="col-sm-4">
                    <div class="card-tools text-right">
                        <div id="divPrint" class="btnXX"></div>
                        <div id="divExcel" class="btnXX"></div>                        
                    </div>
                </div>
            </div>

            

            <div style="border:solid transparent;" class="row">
                <div class="col-xl-4 col-md-4 col-lg-4 col-xs-11">
                    <div class="row">
                        <div class="col-sm-12 ">
                            <div id="divchkPeriod"> </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-5 col-lg-3 col-sm-3 ">
                    <div class="row">
                        <div class="col-md-9 pr-0" style="max-width:180px">
                            <div id="divFromDt"></div>
                            <div id="divAsOn"> </div>
                        </div>
                        <div class="col-md-3  pr-0">
                            <div id="divbtnDisp"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-9 pr-0" style="max-width:180px">
                            <div id="divToDt"></div>
                        </div>
                        
                    </div>
                </div>                
                
                <div class="col-xl-3 col-md-3 col-lg-3 col-xs-11">
                    <div id="divFor"></div>
                </div>
                
            </div>

            

            <div class="row">
                <div class="col-sm-12">
                    <div id="divGrid" style="width: 100%;"></div>

                </div>
            </div>

        </div>

        <input type="hidden" id="HdnCurrMnth" />
        <input type="hidden" id="HdnAccDt" />
        <input type="hidden" id="HdnToAccDt" />
        <input type="hidden" id="HdnAccMnth" />
        <input type="hidden" id="HdnFrmMnth" />
        <input type="hidden" id="HdnToMnth" />
        <input type="hidden" id="HdnYrFrmMnth" />
        <input type="hidden" id="HdnYrToMnth" />


        <style>
            .lblNote .webix_template {
                background: transparent !important;
                color: red !important;
                font-size: 10px !important ";;
            }

            .btn-custom1 {
                color: #000;
                background-color: #ffffff;
                /* border-color: #cccccc; */
                background: transparent;
                padding: 0px 8px;
                font-size: 18px;
                color: #0798af;
                height: 25px !important;
                border: none !important;
            }

            .btnXX {
                display: inline-block;
                text-align: center;
                vertical-align: middle;
                line-height: 1.5;
            }

            .btn-custom {
                color: #000;
                background-color: #ffffff;
                /* border-color: #cccccc; */
                background: transparent;
                padding: 2px 4px;
                font-size: 18px;
                color: #0798af;
                white-space: nowrap;
            }

                .btn-custom:hover {
                    color: white !important;
                    background-color: rgb(40, 132, 179);
                    border-color: #cccccc;
                    /* padding: 3px 7px; */
                }

                .btn-custom > i {
                    padding-left: 5px;
                }

            .btn-custom1 {
                color: #000;
                background-color: #ffffff;
                /* border-color: #cccccc; */
                background: transparent;
                padding: 0px 8px;
                font-size: 18px;
                color: #0798af;
                height: 25px !important;
                border: none !important;
            }

            .GrpTot1 {
                color: black;
                font-weight: Bold;
                font-family: Arial !important;
            }

            .GrpTotBAckCol {
                background-color: #eaeaea !important;
                color: #16888e !important;
                font-weight: Bold !important;
                font-family: Arial !important;
            }

            .MyDb .webix_cell.webix_dtable_colrow {
                background-color: #3b99b5 !important;
                color: white !important;
            }

            .GrpHead {
                color: black;
                font-weight: Bold;
                font-family: Arial !important;
            }
        </style>

        @*Topmenu Style ends*@
        <style>
            .Pagefalse {
                pointer-events: none;
                opacity: 0.6;
            }

            .btn-filter .webix_button {
                border: none !important;
                background: none !important;
            }

            .btn-option .webix_icon_btn {
                font-weight: normal !important;
            }

            .webix_el_radio .webix_label_right, .webix_inp_radio_border {
                display: table-cell;
                vertical-align: top;
            }
            .webix_radio_option {
               height:15px !important;
            }
            .optHeight {
                height: 60px !important;
            }
            .multiline {
                line-height: 16px !important;
                justify-content: center;
                align-items: center;
                content: 'x';
                display: flex;
            }
        </style>

        <script>

    //debugger;
    var body = document.body,
    html = document.documentElement;

    function fnExcelExport() {
        //debugger;
        //webix.env.cdn = "http://localhost:60000/Reports";
        var vGrid = "";
        var CompId = $$("Property").getValue();
        vGrid = $$("gridMain");

        var CompNm = $$("Property").getText();
        var AsOn =  $$("AsOnDt").getText();
        var values = fnCurrDtTime();
        var vDate = values[0];
        var vTm = values[1];
        var OptRptType = $$("OptRptType").getValue();
        var FromDt = $$("FromDt").getText();
        var ToDt = $$("ToDt").getText();

        var vHeader = $("#lblRptCaption").text();
        var FullData = "";
        FullData = vGrid.serialize();
        var len = FullData.length;
        if (len > 0) {
            var vExpoartGrid = webix.copy($$("gridMain"),-1);
            if(OptRptType == "1") fnComExcelExport(vExpoartGrid,vHeader,vHeader,true,CompNm,vDate,vTm,"","",AsOn);
            else fnComExcelExport(vExpoartGrid,vHeader,vHeader,true,CompNm,vDate,vTm,FromDt,ToDt,"");
            //webix.toExcel(vGrid, {
            //    filename: vHeader,
            //    styles: true,
            //    spans: true,
            //    name: vHeader,
            //    docHeader: "<div class='row'><div class='col-4 col-sm-4  text-left' style='font-weight:bold !important'>" + CompNm + "</div>" + "<div class='col-4 col-sm-4  text-center' style='text-align:center !important;font-weight:bold !important'>" + vHeader + "</div></div>" + "<div class='row'>" + "<div class='col-12 col-sm-12 text-center'> AsOn : " + AsOn + "</div></div>",
            //    rawValues: true,

            //});
        }
        else {
            alert("Records not present in Report");
        }

    };
    function fnGridPrint() {
        debugger;
        var vHeader = $("#lblRptCaption").text();
        var FullData = "";
        var vGrid = "";
        var CompId = $$("Property").getValue();
        vGrid = $$("gridMain");

        var CompNm = $$("Property").getText();
        var AsOn =  $$("AsOnDt").getText();
        //var values = fnCurrDtTime();
        //var vDate = values[0];
        //var vTm = values[1];
        var OptRptType = $$("OptRptType").getValue();
        var FromDt = $$("FromDt").getText();
        var ToDt = $$("ToDt").getText();

        var DocHeader = "";
        if(OptRptType == "1"){
            DocHeader = "<div class='row'><div class='col-4 col-sm-4  text-left' style='font-weight:bold !important'>" + CompNm + "</div>" + "<div class='col-4 col-sm-4  text-center' style='text-align:center !important;font-weight:bold !important'>" + vHeader + "</div></div>" + "<div class='row'>" + "<div class='col-12 col-sm-12 text-center'> AsOn : " + AsOn + "</div></div>";
        }
        else {
            DocHeader = "<div class='row'><div class='col-4 col-sm-4  text-left' style='font-weight:bold !important'>" + CompNm + "</div>" + "<div class='col-4 col-sm-4  text-center' style='text-align:center !important;font-weight:bold !important'>" + vHeader + "</div></div>" + "<div class='row'>" + "<div class='col-12 col-sm-12 text-center'> From: " + FromDt + "   To: " + ToDt + "</div></div>";
        }

        FullData = vGrid.serialize();
        var len = FullData.length;
        if (len > 0) {
            //var vExpoartGrid = webix.copy($$("gridMain"),-1);
            //fnComPrintGrid(vExpoartGrid,vHeader,vHeader,true,CompNm,vDate,vTm,"","",AsOn);

            webix.print(vGrid, {
                //docHeader: vHeader, //{ text: vHeader, fontSize: 25 },

                docHeader: DocHeader,
                fit: "page",
                scroll: false,
                mode: "landscape"
            });
        }
        else {
            alert("Records not present in Report");
        }

    };

    function fnCurrDtTime() {
        var vDate = "";
        var vTime = "";
        var rowData = [];
        var CompId = $$("Property").getValue();
        Request = {
            REQTYPE: "GET_FNLOADCURRDTTM",
            COMPID: CompId,
        }
        var DataVal = JSON.stringify(Request);
        $.ajax({
            async: false,
            url: "/Reports/FOAPI_CALL",
            type: 'POST',
            data: "request=" + DataVal,
            success: function (d) {
                debugger;
                if (d != "") {
                    rowData = JSON.parse(d);
                    vDate = rowData.GDate;
                    vTime = rowData.GTime;

                }
            },
        });

        return [vDate, vTime];

    };

    $(document).ready(function () {
        //$("#pageloaddiv").hide();

        var VMD = @Html.Raw(Json.Encode(ViewBag.VMD));
        var cmpid = @Html.Raw(Json.Encode(ViewBag.COMP));
       
        $("#MenuName").val('FOMNUQUAUTOCHRG');
        $("#MenuLvl").val('FOMNUQU');
        $("#MenuLvl1").val('');
        


        var Print = "<span  class='wc_fnt18 fas fa-1x  fa-print'></span>";
        var excel = "<span  class=' wc_fnt18 far fa-1x fa-file-excel'></span>";
        
        webix.ready(function () {
            //debugger;

            webix.ui({
                view: "button", id: "btnPrint", value: "Print", width: 30, container: "divPrint", label: Print, tooltip: true,
                on: {
                    onItemClick: function () {
                        fnGridPrint();
                    }
                }
            });

            webix.ui({
                view: "button", id: "btnExcel", value: "Excel", width: 30, container: "divExcel", label: excel, tooltip: true,
                on: {
                    onItemClick: function () {
                        fnExcelExport();

                    }
                }
            });            

            webix.ui({container: "divPropbox",view: "richselect", id: "Property",on: {onChange: function (newVal,OldVal) {fnPropChange(newVal,"1");}}});            
            webix.ui({
                container: "divAsOn", view: "datepicker", name: "AsOnDt", id: "AsOnDt", format: "%d/%m/%Y", stringResult: true, label: "AsOn", labelWidth: 40,
                on: {
                    onChange: function () {
                        SMAsOnChange();
                    }
                }
            });

            webix.ui({ container: "divFor", view: "richselect",label:"Charge Pattern",labelWidth:100, id: "ddlChrgPatt",value:"1",hidden:true,
                options:[{id:"0", value:"<-ALL->"}, {id:"1",value:"All Nights"},{id:"2",value:"Specific Date"},{id:"3",value:"First Night Arrival"}],on: {
                    onChange: function () {
                        //debugger;
                        $$("gridMain").clearAll();

                    }
                }
            });

            webix.ui({
                container: "divFromDt", view: "datepicker", name: "FromDt", id: "FromDt", format: "%d/%m/%Y", stringResult: true, label: "From", labelWidth: 40,
                on: {
                    onChange: function () {
                        //debugger;
                        SMFromDateChange();

                    }
                }
            });
            webix.ui({ container: "divbtnDisp", css: "webix_primary", view: "button", id: "btnDisplay",  label: "Display", inputWidth: 60, width: 60, click: function () { fnLoadGrid(); } }),
            webix.ui({
                container: "divToDt", view: "datepicker", name: "ToDt", id: "ToDt", format: "%d/%m/%Y", stringResult: true, label: "To", labelWidth: 40,
                on: {
                    onChange: function () {
                        SMToDateChange();
                    }
                }
            });            

            webix.ui({ container: "divchkPeriod",
                padding: { top: 0, left: 0, bottom: 0, right: 0 },height:50,css:"optHeight",
                view: "radio", id: "OptRptType", customRadio:false,  click: function () {fnOptionClick();},
                options:[
                    { value:"InHouse", id:"1" },
                    { value:"Expected", id:"2" },
                    { value:"Posted/Charged", id:"3" },                    

                ],vertical:true,value:"1",
            }),
                       
            
            LoadProperty(cmpid);
            //debugger;
            var propchk = @Html.Raw(Json.Encode(ViewBag.MLTPROPHISHIND));
            if (propchk == "1") $("#divPropbox").show();
            else if (propchk == "0") $("#divPropbox").hide();
            gridResize();

        });

        webix.event(window, "resize", function () {
            gridResize();
        })

    });

    function gridResize(){
        //debugger;
        var vheight = window.innerHeight
               || document.documentElement.clientHeight
               || document.body.clientHeight;
        var offset =  $("#divGrid").offset();

        if($$("gridMain").isVisible() == true){
            $$("gridMain").define("height", ((vheight - offset.top-50)));
            $$("gridMain").adjust();
        }



    }
    
    function LoadProperty(cmpid) {
        debugger;
        Request = {
            REQTYPE: "GET_PROPERTYLOAD",
            COMPID: cmpid,
        }
        Prop_Id = cmpid;
        var rowData = [];
        var options =[];

        var DataVal = JSON.stringify(Request);
        $.ajax({
            async: false,
            url: "/Reports/FOAPI_CALL",
            type: 'POST',
            data: "request=" + DataVal,
            success: function (d) {
                debugger;
                if (d != "") {
                    rowData = JSON.parse(d);
                    $$("Property").define("options",rowData);
                    $$("Property").refresh();
                    $$("Property").setValue(Prop_Id);

                }
            },
        });
    }

    function GridDesign() {
        if($$("gridMain") != null) $$("gridMain").destructor();
        webix.ui({
            id: "gridMain",
            container: "divGrid",
            select: 'row',
            view: "datatable",
            fixedRowHeight: false,
            resizeColumn:true,
            rowLineHeight: 23,
            autoConfig: true,
            editable: true,
            spans: true,
            position: "flex",
            css: "webix_header_border ",
            data: [],            
            columns: [
                { id: "ROOM_TYPE",header:[{text: 'Room Type',css:"multiline"}],  width: 60,  css: { 'text-align': 'center ! important' } },
                { id: "ROOM_NO", header:[{text: "Room No.",css:"multiline"}],width: 60, css: { 'text-align': 'center ! important' }, },
                { id: "ARRIVAL_DT", header: "Arrival", width: 80, css: { 'text-align': 'center ! important' }   },
                { id: "DEPART_DT", header: "Departure", width: 80, css: { 'text-align': 'center ! important' }   },
                { id: "GUEST_NM", header: "Guest Name", minWidth: 180,maxWidth:300,fillspace:true, css: { 'text-align': 'left ! important' }   },
                { id: "CHARGE_REV", header: "Charge Revenue", minWidth: 150,maxWidth:300,fillspace:true, css: { 'text-align': 'left ! important' }   },
                { id: "CHARGE_PAT", header:[{text: "Charge Pattern",css:"multiline"}], width:110,css: { 'text-align': 'left ! important' }   },
                { id: "CURRENCY", header: "Currency", width: 70, css: { 'text-align': 'center ! important' }   },                
                { id: "AMT", header: "Charge Rate", width: 105, css: { 'text-align': 'right ! important' } , exportType: "number", exportFormat: "#,##0.00",   },
                { id: "BASE_AMT", header: "Base Amount", width: 105, css: { 'text-align': 'right ! important' } , exportType: "number", exportFormat: "#,##0.00",hidden:true},
                { id: "UNIT", header: "Unit", width: 50, css: { 'text-align': 'right ! important' } ,  },
                { id: "TOT", header: "Total Charge", width: 105, css: { 'text-align': 'right ! important' } , exportType: "number", exportFormat: "#,##0.00",   },                
                { id: "C_BY", header: "Create By",width: 85, css: { 'text-align': 'center ! important' }, },
                { id: "C_DT", header:"Create Dt",width: 120, css: { 'text-align': 'center ! important' }, },
                { id: "U_BY", header: "Update By",width: 85, css: { 'text-align': 'center ! important' }, },
                { id: "U_DT", header: "Update Dt",width: 120, css: { 'text-align': 'center ! important' }, },
                { id: "CLR", hidden: true },
            ],
            data: [],
            scheme: {
                $init: function (item) {
                    if (item.CLR != "" && item.CLR != null) {
                        var Columns = $$('gridMain').config.columns;
                        var ColCnt = Columns.length;
                        if (item.CLR == "GrpHead") {
                            //debugger;
                            $$("gridMain").addSpan(item.id, "RevNm", ColCnt, 1, null, "GrpHead");
                            $$("gridMain").refresh();
                        }
                        else item.$css = item.CLR;
                    }
                },
                $export: function (obj) {
                    //debugger;
                    var item = webix.copy(obj);

                    if (item.CLR != "ExcelHead") {
                        $.each(obj, function (key, value) {
                            //debugger;
                            ColId = key;
                            if(ColId == "AMT" && ColId == "BASE_AMT" && ColId == "TOT" ){
                                var vBal = value;
                                if (vBal != null && vBal != undefined) {
                                    var vBal1 =  vBal.replace(/[,]/g, '');
                                    vBal1 = parseFloat(vBal1);
                                    item[ColId] = vBal1;
                                }
                            }
                        })
                    }
                    return item;
                }
            },

            on: {
                onBeforeClose: function () {
                    return false;
                },

                'onItemDblClick': function (id) {
                   
                }
            }
        });
        
        gridResize();

    };
    function fnGetFirstDateOfMonth(InputDate) {
        //debugger;
        var Parts = StrDt.split("/");
        var Dt = Parts[0];
        var Mn = Parts[1];
        var Yr = Parts[2];
        var Str = "01" + "/" + Mn + "/" + Yr;
        return Str;

    };    
    function fnPropChange(CompId,vLoad){
        debugger;
        window.BASE_CURRENCY = "";
        window.CURR_DT = "";
        window.CURRENCY_FORMAT = "";
        window.CURRENCY_DELIMIT = "";
        window.CURRENCY_DECIMLIMIT = "";
        window.CPN_MODE_RES="";
        window.CatAppl = "";
        window.H14_Ind = "";
        window.G11_Ind = "";
        window.U11_Ind = "";
        window.PROPCHANGE="1";
                
        $("#divAsOn").show();
        $("#divToDt").hide();
        $("#divFromDt").hide();
        $$("AsOnDt").setValue('');
        $$("ddlChrgPatt").hide();              

        LoadInds(CompId);

        debugger;
        
        $$("OptRptType").show();        
        $$("OptRptType").setValue("1");
        $$("AsOnDt").setValue('');
        $$("FromDt").setValue('');
        $$("ToDt").setValue('');
        
        GridDesign();
        $$("ddlChrgPatt").show();
        $$("ddlChrgPatt").setValue('0');
              
        LoadDate(CompId);
        fnOptionClick();
        //fnLoadGrid();
        debugger;

    };
    function LoadDate(cmpid) {
        debugger;

        Request = {
            REQTYPE: "GET_FRMMNTHTOMNTH",
            COMPID: cmpid,
        }

        var DataVal = JSON.stringify(Request);

        $.ajax({
            async: false,
            url: "/Reports/FOAPI_CALL",
            type: 'POST',
            data: "request=" + DataVal,

            success: function (data) {
                debugger;
                var data1 = JSON.parse(data);
                var vCurrDt = data1[0].CURRDT.toString().trim();
                var vAccDt = data1[0].ACC_DT.toString().trim();
                var vToAccDt = data1[0].TO_ACC_DT.toString().trim();
                var vAccMnth = data1[0].ACC_MNTH.toString().trim();
                var vFromMnth = data1[0].FRMMNTH.toString().trim();
                var vToMnth = data1[0].TOMNTH.toString().trim();

                $("#HdnCurrDt").val(vCurrDt);
                $("#HdnAccDt").val(vAccDt);
                $("#HdnAccMnth").val(vAccMnth);
                $("#HdnFrmMnth").val(vFromMnth);
                $("#HdnToMnth").val(vToMnth);

                var vFromDt = formatDate(vAccDt);
                var vToDt = formatDate(vAccDt);
                $$("AsOnDt").setValue(vFromDt);
                $$("FromDt").setValue(vFromDt);
                $$("ToDt").setValue(vFromDt);

            },
        });
    };

    var LoadInds = function (CompId) {
        debugger;
        //var  JSON.parse(request);

        window.BASE_CURRENCY = "";
        window.CURR_DT = "";

        window.CURRENCY_FORMAT = "";
        window.CURRENCY_DELIMIT = "";
        window.CURRENCY_DECIMLIMIT = "";
        window.CPN_MODE_RES = "";

        window.CatAppl = "";
        window.H14_Ind = "";
        window.G11_Ind = "";
        window.U11_Ind = "";

        Request = {
            REQTYPE: "GET_FNGETLOADCONTALL",
            COMPID: CompId,
        }

        var rowData = [];
        var options = [];
        var dataparam = JSON.stringify(Request);

        $.ajax({
            async: false,
            url: "/Reports/FOAPI_CALL",
            type: 'POST',
            data: "request=" + dataparam,
            success: function (d) {
                debugger;
                var Detemp = JSON.parse(d);
                window.BASE_CURRENCY = Detemp.RA[0].BASE_CURRENCY_ID == null?"": $.trim(Detemp.RA[0].BASE_CURRENCY_ID);
                window.CURR_DT = Detemp.RA[0].CURDT1 == null?"": Detemp.RA[0].CURDT1;

                window.CURRENCY_FORMAT = Detemp.RA[0].CURRENCY_FORMAT == null || $.trim(Detemp.RA[0].CURRENCY_FORMAT) == "" ?"L":Detemp.RA[0].CURRENCY_FORMAT;
                window.CURRENCY_DELIMIT = Detemp.RA[0].CURRENCY_DELIMIT == null || Detemp.RA[0].CURRENCY_DELIMIT == "" ?".":Detemp.RA[0].CURRENCY_DELIMIT;
                window.CURRENCY_DECIMLIMIT = Detemp.RA[0].VAL_DECIM_LIMIT == null || Detemp.RA[0].VAL_DECIM_LIMIT == "" ?"2":Detemp.RA[0].VAL_DECIM_LIMIT;
                window.CPN_MODE_RES = Detemp.RA[0].CPN_MODE_RES == null?"":Detemp.RA[0].CPN_MODE_RES;

                window.H14_Ind = Detemp.RA3[0].H14_IND == null || $.trim(Detemp.RA3[0].H14_IND) == "" ? "0" : Detemp.RA3[0].H14_IND ;
                window.CatAppl = Detemp.RA3[0].J14_IND == null || $.trim(Detemp.RA3[0].J14_IND) == "" ? "0" : Detemp.RA3[0].J14_IND ;
                window.G11_Ind = Detemp.RA3[0].G11_IND == null || $.trim(Detemp.RA3[0].G11_IND) == "" ? "0" : Detemp.RA3[0].G11_IND ;
                window.U11_Ind = Detemp.RA3[0].U11_IND == null || $.trim(Detemp.RA3[0].U11_IND) == "" ? "0" : Detemp.RA3[0].U11_IND ;
                window.H14_Ind = Detemp.RA3[0].H14_IND == null || $.trim(Detemp.RA3[0].H14_IND) == "" ? "0" : Detemp.RA3[0].H14_IND ;


            },
            error: function (request, status, error) {
                console.log("Error Failrue");
            }
        });
        
    };
    function fnOptionClick() {  
        debugger;
        var CompId = $$("Property").getValue();
        $$("gridMain").clearAll();
        if ($$("OptRptType").getValue() == "1") {
            $("#divAsOn").show();             
            $("#divToDt").hide();
            $("#divFromDt").hide();
            $$("gridMain").getColumnConfig("ROOM_NO").header[0].text = "Room No.";
            $$("gridMain").getColumnConfig("AMT").header[0].text = "Charge Rate";
            $$("gridMain").hideColumn("BASE_AMT");
            $$("gridMain").showColumn("CHARGE_PAT");
            $$("gridMain").showColumn("TOT");
            $$("gridMain").showColumn("UNIT");
            $$("gridMain").refreshColumns();

            $("#lblRptCaption").text('Auto Charges (In House)');
            $$("ddlChrgPatt").show();
        }
        else{
            $("#divAsOn").hide();              
            $("#divToDt").show();
            $("#divFromDt").show();
            if ($$("OptRptType").getValue() == "2"){            
                $$("gridMain").getColumnConfig("ROOM_NO").header[0].text = "Reserve No.";
                $$("gridMain").getColumnConfig("AMT").header[0].text = "Charge Rate";
                $$("gridMain").hideColumn("BASE_AMT");
                $$("gridMain").showColumn("TOT");
                $$("gridMain").showColumn("UNIT");
                $$("gridMain").showColumn("CHARGE_PAT");
                $$("gridMain").refreshColumns();
                $("#lblRptCaption").text('Auto Charges (Expected)');
                $$("ddlChrgPatt").show();
            }
            else if ($$("OptRptType").getValue() == "3"){            
                $$("gridMain").getColumnConfig("ROOM_NO").header[0].text = "Room No.";
                $$("gridMain").getColumnConfig("AMT").header[0].text = "Total Charge";
                $$("gridMain").showColumn("BASE_AMT");
                $$("gridMain").hideColumn("TOT");
                $$("gridMain").hideColumn("UNIT");
                $$("gridMain").hideColumn("CHARGE_PAT");
                $$("gridMain").refreshColumns();
                $("#lblRptCaption").text('Auto Charges (Posted)');

                $$("ddlChrgPatt").setValue('0');
                $$("ddlChrgPatt").hide();
            }
        }

        //fnShowHideCol();

    };       
    function fnLoadGrid() {
        
        if (fnChkSessVal() == false) return;        
        var OptRptType = $$("OptRptType").getValue();        
        var CompId = $$("Property").getValue();        
        $$("gridMain").clearAll();
        
        var Ason = "";
        var FromDt = "";
        var ToDt = "";
        debugger;
        if(OptRptType == "2" || OptRptType == "3" ){
            FromDt = $$("FromDt").getText();
            ToDt = $$("ToDt").getText();
        }
        else Ason = $$("AsOnDt").getText();

        if (OptRptType == "2" || OptRptType == "3") {
            if (FromDt == "" || ToDt == "") return;
        }
        else {
            if (Ason == "") return;
        }        
        $("#pageloaddiv").show();
        var CH_PATTERN = $$("ddlChrgPatt").getValue();

        if(OptRptType == "3") CH_PATTERN = "0";

        Request = {
            REQTYPE: "GET_FNLOADAUTOCHARGE",
            COMPID: CompId,
            ASONDT: Ason,
            FROMDT: FromDt,
            TODT: ToDt,
            RPTTYPE: OptRptType ,     
            CH_PATTERN:CH_PATTERN,
            BASE_CURR:window.BASE_CURRENCY 
        }
        var rowData = [];
        requestData = JSON.stringify(Request);
        requestData = encodeURIComponent(requestData);
        $.ajax({
            async: true,
            url: "/Reports/FOAPI_CALL",
            type: 'POST',
            data: "request=" + requestData,
            success: function (data) {
                debugger;
                if (data != "") {
                    $$("gridMain").clearAll();
                    rowData = JSON.parse(data);                    
                    $$("gridMain").parse(rowData);
                }
                else $("#pageloaddiv").hide();
            },
            complete: function () {
                $("#pageloaddiv").hide();
            },
            error: function (request, status, error) {
                console.log("Error Failure");
                $("#pageloaddiv").hide();
            }
        });
    };
    function formatDate(StrDt) {
        debugger;
        var Parts = StrDt.split("/");
        var Dt = Parts[0];
        var Mn = Parts[1];
        var Yr = Parts[2];
        var Str = Yr + "-" + Mn + "-" + Dt;
        return Str;
    };
    function formatDate1(StrDt) {
        debugger;
        var Parts = StrDt.split("-");
        var Yr = Parts[0];
        var Mn = Parts[1];
        var Dt = Parts[2];
        var Str = Dt + "/" + Mn + "/" + Yr;
        return Str;
    };
    function CurrFormat(value, Currfrmt, CurrDelimit, CurrDecimal) {
        //debugger;

        if (value == null) return "";

        if (value.toString() != "") {


            if (Currfrmt == "L") {
                var x = parseFloat(value).toFixed(CurrDecimal);
                var neg = false;
                if (value < 0) {
                    neg = true;
                    //x = math.abs(x);
                }

                x = x.toString();
                var afterPoint = '';
                //if (x.indexOf('.') > 0) {
                //    afterPoint = x.substring(x.indexOf('.') + 1, x.length);
                //    afterPoint = CurrDelimit + afterPoint
                //}
                //x = Math.floor(x);
                var vArr = x.split('.');
                x = vArr[0].toString().trim();
                afterPoint = vArr[1].toString().trim();
                afterPoint = CurrDelimit + afterPoint

                x = x.toString();
                var lastThree = x.substring(x.length - 3);
                var otherNumbers = x.substring(0, x.length - 3);
                if (otherNumbers != '' && otherNumbers != '-')
                    lastThree = ',' + lastThree;
                return otherNumbers.replace(/\B(?=(\d{2})+(?!\d))/g, ",") + lastThree + afterPoint;
            }
            else {
                var x = parseFloat(value).toFixed(CurrDecimal);
                var neg = false;
                if (value < 0) {
                    neg = true;
                    //x = math.abs(x);
                }

                x = x.toString();

                //var res = x.replace(/(\d)(?=(\d{3})+(?!\d))/g, "1,")  //+ afterPoint;
                //var res = x.replace(/(\d{3})/g, "1,")
                var res = x.replace(/\B(?=(\d{3})+(?!\d))/g, ",")

                if (res.indexOf('.') > 0) {

                    res = res.replace(".", CurrDelimit)
                }


                return res;
            }
        }
        else {
            return value;
        }
    };
    function fnCurrFormat(value) {

        var Currfrmt = window.CURRENCY_FORMAT;
        var CurrDelimit = window.CURRENCY_DELIMIT;
        var CurrDecimal = window.CURRENCY_DECIMLIMIT;
        return CurrFormat(value, Currfrmt, CurrDelimit, CurrDecimal);

    };  
    
    
    function fnChkSessVal() {
        debugger;
        var bVal = "0";
        $.ajax({
            async: false,
            url: "/Reports/fnChkSessionval",
            type: 'POST',
            success: function (data) {
                debugger;
                if (data == "1") {
                    bVal = "1";
                }
            },
            error: function (request, status, error) {
                bVal = "0";
            }
        });
        if (bVal == "1") return true;
        else {
            debugger;
            var Host = window.location.host;
            var LoadingUrl = "http://" + Host + "/Login.aspx";
            window.location.href = LoadingUrl;
        }
    };    
    function fnDateAdd(vDate, vCount, vType) {
        debugger;
        var CompId = $$("Property").getValue();
        var Request = {
            REQTYPE: "GET_FNRETDATEADD",
            COMPID: CompId,
            DATE: vDate,
            DAYS: vCount,
            FORMAT: vType

        }
        var rowData = "";
        requestData = JSON.stringify(Request);
        requestData = encodeURIComponent(requestData);
        $.ajax({
            async: false,
            url: "/FOMaster/FOAPI_CALL",
            type: 'POST',
            data: "request=" + requestData,
            success: function (data) {
                debugger;
                if (data != "") {
                    rowData = JSON.parse(data);
                }
            },
            error: function (request, status, error) {
                console.log("Error Failrue");
            }
        });

        return rowData

    };

   

        </script>
        <script type="text/javascript">

            $(document).on('shown.lte.pushmenu', function () {
                var timeoutID;
                function delayedStart() {
                    timeoutID = window.setTimeout(resizeAction, 350);
                }

                function resizeAction() {
                    sidebarFn(1);
                    //  alert("Sidebar is collapsed or expanded!")
                    window.clearTimeout(timeoutID);
                }

                delayedStart();

            }).on('collapsed.lte.pushmenu', function () {
                var timeoutID;
                function delayedStart() {
                    timeoutID = window.setTimeout(resizeAction, 350);
                }

                function resizeAction() {
                    sidebarFn(2);
                    //  alert("Sidebar is collapsed or expanded!")
                    window.clearTimeout(timeoutID);
                }

                delayedStart();
            });
            function  sidebarFn(val){


                $$("gridMain").resize();
            }

            function SMToDateChange(e) {
                debugger;
                $$("gridMain").clearAll();
                var frmdate = $$("FromDt").getText();
                var todate = $$("ToDt").getText();
                var sFrmDt = $$("ToDt").getText();
                var vAccDt = $("#HdnAccDt").val();
                var bSucc = "1";

                if (frmdate == "") {
                    bSucc = "0";
                    return false;
                }
                if (todate == "") {
                    bSucc = "0";
                    return false;
                }

                $.ajax({
                    type: "POST",
                    url: "/Reports/FTDateValidation",
                    cache: false,
                    async: false,
                    charset: 'utf-8',
                    data: "F=" +  frmdate + "&T=" + todate,
                    success: function (data) {
                        if (data.d != "") {
                            debugger;
                            var vToDt = formatDate(sFrmDt);
                            $$("FromDt").setValue(new Date(vToDt));
                            bSucc = "0";

                        }
                    }
                });

                if(bSucc=="0") return false;


                //$.ajax({
                //    type: "POST",
                //    url: "/Reports/FTDateValidation",
                //    cache: false,
                //    async: false,
                //    charset: 'utf-8',
                //    data: "F=" + vAccDt   + "&T=" +  todate,
                //    success: function (data) {
                //        if (data.d != "") {
                //            debugger;
                //            var vFromDt = formatDate(vAccDt);
                //            $$("ToDt").setValue(new Date(vFromDt));
                //            bSucc = "0";
                //        }
                //    }
                //});

                //if(bSucc=="0") return false;

            };


            function SMFromDateChange(e) {
                debugger;
                $$("gridMain").clearAll();
                var frmdate = $$("FromDt").getText();
                var todate = $$("ToDt").getText();
                var sFrmDt = $$("FromDt").getText();
                var vAccDt = $("#HdnAccDt").val();

                var bSucc = "1";

                if (frmdate == "") {
                    //webix.message("From Date can't be empty", "warning", 800);
                    $("#LoadDIv").hide();
                    bSucc = "0";
                    return false;
                }


                if (todate == "") {
                    //webix.message("To Date can't be empty", "warning", 800);
                    $("#LoadDIv").hide();
                    bSucc = "0";
                    return false;
                }

                $.ajax({
                    type: "POST",
                    url: "/Reports/FTDateValidation",
                    cache: false,
                    async: false,
                    charset: 'utf-8',
                    data: "F=" + frmdate + "&T=" + todate,
                    success: function (data) {
                        if (data.d != "") {
                            debugger;
                            //webix.message("From Month Should be less than To Month ", "warning", 500);
                            $("#LoadDIv").hide();
                            //$$("ToMthDate").setValue(FrmMnth);
                            var vToDt = formatDate(sFrmDt);
                            $$("ToDt").setValue(new Date(vToDt));
                            bSucc = "0";
                        }
                    }
                });
                if(bSucc=="0") return false;


                //$.ajax({
                //    type: "POST",
                //    url: "/Reports/FTDateValidation",
                //    cache: false,
                //    async: false,
                //    charset: 'utf-8',
                //    data: "F=" +  frmdate  + "&T=" +  vAccDt,
                //    success: function (data) {
                //        if (data.d != "") {
                //            debugger;
                //            //webix.message("From Month Should be less than To Month ", "warning", 500);
                //            $("#LoadDIv").hide();
                //            //$$("FromDt").setValue(vAccDt);
                //            var vFromDt = formatDate(vAccDt);
                //            $$("FromDt").setValue(new Date(vFromDt));


                //            bSucc = "0";
                //        }
                //    }
                //});

                //if(bSucc=="0") return false;


            };


            function SMAsOnChange(e) {
                debugger;
                $$("gridMain").clearAll();
                var frmdate = $$("AsOnDt").getText();
                var vAccDt = $("#HdnAccDt").val();

                var bSucc = "1";

                if (frmdate == "") {
                    //webix.message("From Date can't be empty", "warning", 800);
                    $("#LoadDIv").hide();
                    bSucc = "0";
                    return false;
                }
                //$.ajax({
                //    type: "POST",
                //    url: "/Reports/FTDateValidation",
                //    cache: false,
                //    async: false,
                //    charset: 'utf-8',
                //    data: "F=" +  frmdate  + "&T=" +  vAccDt,
                //    success: function (data) {
                //        if (data.d != "") {
                //            debugger;
                //            //webix.message("From Month Should be less than To Month ", "warning", 500);
                //            $("#LoadDIv").hide();
                //            //$$("FromDt").setValue(vAccDt);
                //            var vFromDt = formatDate(vAccDt);
                //            $$("AsOnDt").setValue(new Date(vFromDt));
                //            bSucc = "0";
                //        }
                //    }
                //});

                //if(bSucc=="0") return false;


            };

        </script>
    </section>
</div>



