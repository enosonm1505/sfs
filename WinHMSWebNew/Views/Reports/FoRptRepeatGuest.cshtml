@{
    ViewBag.Title = "Repeat Guest";
    Layout = "~/Views/Shared/Layout/Fo_ReportLayout.cshtml";
}

@*@Html.Partial("_RptRoomTpSrch")
    @Html.Partial("_RptSegmentTypeSrch")
    @Html.Partial("_RptContForcastOptions")*@
@*@Html.Partial("_CommonMeaasgeWindow")*@
<div class="content-wrapper">
    <section class=" col-xl-12 col-md-12 col-sm-12 themedes p-0 ">
        <link href="../../Content/Contribute.css" rel="stylesheet" />
        <link href="../../Content/bootstrap-4.4.1-dist/css/bootstrap.min.css" rel="stylesheet" />

        <link href="~/Content/sidemenu-webix.css" rel="stylesheet" />
        <link href="~/FO/CSS/sidemenu-custom.css" rel="stylesheet" />
        <div id="MAIN" class="FullwidthDIV">
            <div id="LoadDIv" style="display: block; position: absolute; left: 0px; top: 0px; width: 100%; height: 100%; margin: 0px; fit-position: 100%; z-index: 189">
                <img src="../../Images/progress.GIF" style="position: absolute; left: 50%; top: 45%; height: 100px; width: 80px;" />
            </div>
        </div>        
        <div id="divPage">

            <div class="container-fluid">                
                <div class="row new_hdr">
                    <div class="col-sm-3">

                        <div class="TextWidth" id="divPropbox">
                        </div>
                    </div>
                    <div class="col-sm-5 text-center">
                        <strong>
                            <label style="color: black; font-weight: bold" class="wc_hdr_tlt" id="lblRptCaption"><strong>Repeat Guest </strong></label>
                        </strong>
                    </div>                    
                    <div class="col-sm-4">
                        <div class="card-tools text-right">
                            <div id="divPrint" class="btnXX"></div>
                            <div id="divExcel" class="btnXX"></div>
                        </div>
                    </div>
                </div>                

                <div style="border:solid transparent;" class="row">
                   
                    <div class="col-xl-3 col-md-3 col-sm-6 pr-0">
                        <div class="row">
                            <div class="col-md-12">
                                <div id="divChkComplHU"></div>
                            </div>
                            <div class="col-md-12">
                                <div id="divbtnoptions"></div>
                            </div>   
                        </div>                        
                    </div> 
                    <div class="col-xl-4 col-md-5 col-sm-3 " style="max-width:300px">
                        <div class="row">
                            <div class="col-md-9 ">
                                <div id="divFrom"></div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-9">
                                <div id="divTo"></div>
                            </div>
                            <div class="col-md-3  pr-0">
                                <div id="divbtnDisp"></div>
                            </div>
                        </div>
                    </div>  

                    <div class="col-xl-2 col-md-2 col-lg-2 col-sm-3">
                        <div id="divVisit"></div>
                    </div>

                    <div class="col-xl-2 col-md-2 col-lg-2 col-sm-3">
                        <div id="divGroup"></div>
                    </div>
                    
                                                      
                </div>

                <div class="row">
                    <div class="col-sm-12">
                        <div id="gridRptt" style="width: 100%; height: 460px"></div>
                    </div>
                </div>
            </div>
        </div>        

        <input type="hidden" id="Log" />
        <input type="hidden" id="COMPID" />
        <input type="hidden" id="CURRENCY_FORMAT" />
        <input type="hidden" id="CURRENCY_DELIMIT" />
        <input type="hidden" id="CURRENCY_DECIMLIMIT" />
        <input type="hidden" id="CHK_CONSOLID" value="1" />
        <input type="hidden" id="CHK_SEGMENT" value="0" />
        <input type="hidden" id="CHK_SUMMARY" value="0" />
        <input type="hidden" id="S14_IND" />
        <input type="hidden" id="F11_IND" />
        <input type="hidden" id="J14_IND" />
        <input type="hidden" id="J2_IND" />
        <input type="hidden" id="SALE_IND" />
        <input type="hidden" id="R24_IND" />
        <input type="hidden" id="B3_IND" />
        <input type="hidden" id="PLAN_APPL_IND" />
        <input type="hidden" id="TRAVEL_IND" />
        <input type="hidden" id="SegmntId" />
        <input type="hidden" id="RoomTyId" />
        <input type="hidden" id="HdnCurrDt" />
        <input type="hidden" id="HdnCurrMnth" />
        <input type="hidden" id="HdnAccDt" />
        <input type="hidden" id="HdnToAccDt" />
        <input type="hidden" id="HdnAccMnth" />
        <input type="hidden" id="HdnFrmMnth" />
        <input type="hidden" id="HdnToMnth" />
        <input type="hidden" id="HdnYrFrmMnth" />
        <input type="hidden" id="HdnYrToMnth" />
        <input type="hidden" id="BASE_COUNTRY_ID" />


        <style>
            .btnXX {
                display: inline-block;
                text-align: center;
                vertical-align: middle;
                line-height: 1.5;
            }
        </style>

        @*Topmenu Style ends*@
        <style>
            .Pagefalse {
                pointer-events: none;
                opacity: 0.6;
            }

            .btn-filter .webix_button {
                border: none !important;
                background: none !important;
            }

            .btn-option .webix_icon_btn {
                font-weight: normal !important;
            }

            .multiline {
                line-height: 22px !important;
                position: relative;
            }

            .GrpTot1 {
                color: black;
                font-weight: Bold;
                font-family: Arial !important;
            }

            .GrpTot2 {
                color: black;
                font-weight: Bold;
                font-family: Arial !important;
            }

            .GrpTotBtm {
                background-color: lightgray;
                color: Brown;
                font-weight: Bold;
                font-family: Arial !important;
            }

            .GrpTotGrnd {
                background-color: blue;
                color: white;
                font-weight: Bold;
                font-family: Arial !important;
            }

            .GndTot {
                background-color: blue;
                color: white;
                font-weight: Bold;
                font-family: Arial !important;
            }

            .HideRow {
                display: none !important;
            }

            .WeakEnd {
                background-color: #ffb6c147;
            }

            .PastDay {
                background-color: #f3001673;
            }

            .MyOptBox .webix_radio_option {
                height: 23px;                
            }
        </style>

        <script>

            $(document).ready(function () {
                debugger;

                $("#MenuName").val('FOMNUANALGTSTSTC');
                $("#MenuLvl").val('FOMNUANL');
                $("#MenuLvl1").val('');
                var Print = "<span  class='wc_fnt18 fas fa-1x  fa-print'></span>";
                var excel = "<span  class=' wc_fnt18 far fa-1x fa-file-excel'></span>";
               
                webix.ready(function () {
                    loadOptionPopWindow();
                    GridDesign();

                    webix.ui({
                        view: "button", id: "Print", value: "Print", width: 70, container: "divPrint", label: Print, tooltip: true,
                        on: {
                            onItemClick: function () {
                                fnGridPrint();
                            }
                        }
                    });

                    webix.ui({
                        view: "button", id: "Excel", value: "Excel", width: 70, container: "divExcel", label: excel, tooltip: true,
                        on: {
                            onItemClick: function () {
                                fnExcelExport();
                            }
                        }
                    });

                    webix.ui({
                        id: "gridComp",
                        view: "datatable",
                        hidden:true,
                        data: [],
                        columns: [
                                { id: "id", header: 'COMPANY_ID', width: 100, css: { 'text-align': 'left ! important', }, },
                                { id: "value", header: 'COMPANY_NM', width: 300,css: { 'text-align': 'right ! important', }  },
                                { id: "TYPE", header: 'TYPE', width: 100,css: { 'text-align': 'right ! important', }  },
                                { id: "USER_ID", header: ['USER_ID', ], width: 100,css: { 'text-align': 'right ! important', }  },
                                { id: "SEQ_NO", header: { text: "SEQ_NO", }, width: 100, css: { 'text-align': 'right ! important', } },
                                { id: "DEPART_ID", header: { text: "DEPART_ID", }, width: 100, css: { 'text-align': 'right ! important', } },
                                { id: "ACTIVE_ID", header: { text: "ACTIVE_ID", }, width: 100, css: { 'text-align': 'right ! important', } },
                        ],
                        data: [],
                        on: {
                            onBeforeClose: function () {
                                return false;
                            },
                        }
                    });

                    webix.ui({
                        view: "button", id: "btnOptions",css: "webix_primary",  value: "Options", width: 30,label:'<span class="fa fa-list"></span>', container: "divbtnoptions", tooltip: true,
                        on: {
                            onItemClick: function () {
                                btnOptionClick();
                            }
                        }
                    });

                    webix.ui({ container: "divVisit", view: "text", id: "txtVisits",width: 140, labelWidth: 90, label: "No of Visits => ", inputAlign:"center",attributes: { maxLength: 3 },
                        on: {
                            onChange: function (NewVal, OldVal) {
                                if (NewVal == "" || NewVal < 2 ) {
                                    debugger;
                                    $$("txtVisits").setValue("2");  
                                   
                                }
                                
                            },
                            "onKeyPress": function (code, e) {
                                if (e.key == "'") return false;
                                return fnNumericText(code, e);
                            },
                            "onTimedKeyPress" : function () {
                                ClearGrid();
                            },
                        }
                    });                    

                    webix.ui({ view: "radio", id: "OptGroup", customRadio:false,  click: function () {ClearGrid()},container:"divGroup",css:"MyOptBox",
                        options:[
                            { value:"Country wise", id:"1",height:22 },
                            { value:"Nationality wise", id:"2" },                            

                        ],vertical:true,value:"1",
                    });                  


                    webix.ui({
                        container: "divFrom", view: "datepicker", label: "Depart From ", labelWidth: 90,labelAlign:"right", width:220, name: "FromDt", id: "FromDt", format: "%d/%m/%Y", stringResult: true,
                        on: {
                            onChange: function () {
                                $$("gridRpt").clearAll();
                                var frmdate = $$("FromDt").getValue();
                                var todate = $$("ToDt").getValue();
                                if (frmdate != "" && todate != "") SMFromDateChange();
                            }
                        }
                    });

                    webix.ui({
                        container: "divTo", view: "datepicker", label: "To ", labelWidth: 90,labelAlign:"right", width:220, name: "ToDt", id: "ToDt", format: "%d/%m/%Y", stringResult: true,
                        on: {
                            onChange: function () {
                                $$("gridRpt").clearAll();
                                var frmdate = $$("FromDt").getValue();
                                var todate = $$("ToDt").getValue();
                                if (frmdate != "" && todate != "") SMToDateChange();
                            }
                        }
                    });

                    webix.ui({ container: "divbtnDisp", view: "button", id: "btnDisplay",css: "webix_primary", icon: "wxi-check", label: "Display", inputWidth: 60, width: 80, click: function () { fnbtnDisplay(); } }),
                    webix.ui({ container: "divChkComplHU", view: "checkbox", id: "ChkComplHU", labelWidth: 5, labelRight: "With Comp/HU", customCheckbox: false, click: function () { fnChkComplHUClick(); } }),
                    
                    webix.ui({
                        container: "divPropbox", view: "richselect", id: "Property",//width: 220,//autowidth:true,

                        on: {
                            onChange: function (NewVal, OldVal) {
                                if (NewVal != "") {
                                    debugger;
                                    $$("gridRpt").clearAll();
                                    LoadCompChange(NewVal);
                                }
                            }
                        }

                    });
                    //debugger;

                    var cmpid= @Html.Raw(Json.Encode(ViewBag.COMP));
                    FNLoadAllCompany(cmpid);
                    LoadProperty(cmpid);

                    var propchk = @Html.Raw(Json.Encode(ViewBag.MLTPROPHISHIND));
                    if (propchk == "1") $("#divPropbox").show();
                    else if (propchk == "0") $("#divPropbox").hide();                   

                });

            });

            function FNLoadAllCompany(cmpid) {
                debugger;
                Request = {
                    REQTYPE: "GET_FNLOADALLCOMPANY",
                    COMPID: cmpid,
                }
                var rowData = [];
                var options =[];

                var DataVal = JSON.stringify(Request);
                $.ajax({
                    async: false,
                    url: "/Reports/FOAPI_CALL",
                    type: 'POST',
                    data: "request=" + DataVal,
                    success: function (d) {
                        debugger;
                        if (d != "") {
                            rowData = JSON.parse(d);

                            $$("gridComp").parse(rowData);
                        }
                    },
                });
            };

            //function fnddlForChange(){
            //    debugger;
            //    ClearGrid();
            //    fnHeader();
            //};

            function LoadProperty(cmpid) {
                debugger;
                Request = {
                    REQTYPE: "GET_FNMULPROPERTY",
                    COMPID: cmpid,
                }
                Prop_Id = cmpid;
                var rowData = [];
                var options =[];

                var DataVal = JSON.stringify(Request);
                $.ajax({
                    async: false,
                    url: "/Reports/FOAPI_CALL",
                    type: 'POST',
                    data: "request=" + DataVal,
                    success: function (d) {
                        debugger;
                        if (d != "") {
                            rowData = JSON.parse(d);
                            $$("Property").define("options",rowData);
                            $$("Property").refresh();
                            $$("Property").setValue(Prop_Id);

                        }
                    },
                });
            };

            function LoadDate(cmpid) {
                debugger;

                Request = {
                    REQTYPE: "GET_FRMMNTHTOMNTH",
                    COMPID: cmpid,
                }

                var DataVal = JSON.stringify(Request);

                $.ajax({
                    async: false,
                    url: "/Reports/FOAPI_CALL",
                    type: 'POST',
                    data: "request=" + DataVal,

                    success: function (data) {
                        debugger;
                        var data1 = JSON.parse(data);
                        var vCurrDt = data1[0].CURRDT.toString().trim();
                        var vAccDt = data1[0].FROMDATE.toString().trim();
                        var vToAccDt = data1[0].TODATE.toString().trim();
                        
                        $("#HdnCurrDt").val(vCurrDt);
                        $("#HdnAccDt").val(vToAccDt);
                        $("#HdnToAccDt").val(vAccDt);
                      
                        var vFromDt = formatDate1(vAccDt);
                        var vToDt = formatDate1(vToAccDt);
                        $$("FromDt").setValue(new Date(vFromDt));
                        $$("ToDt").setValue(new Date(vToDt));

                    },
                });
            };
            function formatDate1(StrDt) {
                debugger;
                var Parts = StrDt.split("/");
                var Dt = Parts[0];
                var Mn = Parts[1];
                var Yr = Parts[2].substring(0, 4);
                var Str = Yr + "-" + Mn + "-" + Dt;
                return Str;
            };
            function LoadCompChange(CompId) {

                $$("gridRpt").hideColumn("ixProperty");
                $$("gridRpt").hideColumn("ixPNight");
                $$("gridRpt").hideColumn("ixPRev");

                if (CompId.indexOf(",") >= 0) {
                    vSplit = CompId.split(",");
                    var newData = vSplit.filter(function (el) {
                        return el.toString().trim().toUpperCase() == "WS";
                    });
                    if (newData.length > 0) CompId = newData[0].toString().trim();
                    else CompId = vSplit[0].toString().trim();

                    if(vSplit.length>1){
                        $$("gridRpt").showColumn("ixProperty");
                        $$("gridRpt").showColumn("ixPNight");
                        $$("gridRpt").showColumn("ixPRev");

                    }

                }
                $$("txtMob").setValue('1');    
                $$("txtPlace").setValue('1');
                $$("txtEmail").setValue('1');  
                $$("txtCompany").setValue('1');    

                LoadControl(CompId);
                LoadDate(CompId);
                var W10_IND = "0";
                var CHKPM = "0";                
                $$("txtVisits").setValue("2");
                fnShowColumn();

                //fnLoadContribiute();
                //fnLoadFor();
                //fnHeader();
            };
            function LoadCurrDet(vProperty) {
                //debugger;
                var rowDatad = [];
                try {
                    $.ajax({
                        async: false,
                        type: "POST",
                        url: "/Reports/GetCurrFormatDetails",
                        data: "CmpId=" + vProperty,
                        success: function (d) {
                            if (d != "") {
                                rowDatad = JSON.parse(d);
                                $("#CURRENCY_FORMAT").val(rowDatad.CURRENCY_FORMAT);
                                $("#CURRENCY_DELIMIT").val(rowDatad.CURRENCY_DELIMIT);
                                $("#CURRENCY_DECIMLIMIT").val(rowDatad.CURRENCY_DECIMLIMIT);
                            }
                        }
                    });

                }
                catch (e) {
                    console.log(e.message)
                }
            };
            function LoadControl(CompId) {
                //debugger;
                var rowDatad = [];
                try {
                    Request = {
                        REQTYPE: "GET_FNGETLOADCONT",
                        COMPID: CompId,
                    }

                    var rowData = [];
                    var options =[];
                    var dataparam = JSON.stringify(Request);



                    $.ajax({
                        async: false,
                        url: "/Reports/FOAPI_CALL",
                        type: 'POST',
                        data: "request=" + dataparam,
                        success: function (d) {
                            debugger;
                            if (d != "") {
                                rowDatad = JSON.parse(d);
                                var F11_IND = 0;  var J2_IND = 0;
                                var SALE_IND = 0; var Q15_IND = 0;
                                var R24_IND = 0;  var TARIFF_EDIT_IND = 0; var RESERVE_PROV_APPL_IND = 0; var K_TAX = 0; var BASE_COUNTRY_ID = "";

                                if (rowDatad.RA3[0].F11_IND != null && rowDatad.RA3[0].F11_IND != "") F11_IND = parseInt(rowDatad.RA3[0].F11_IND.toString().trim());
                                if (rowDatad.RA3[0].J2_IND != null && rowDatad.RA3[0].J2_IND != "") J2_IND = parseInt(rowDatad.RA3[0].J2_IND.toString().trim());
                                if (rowDatad.RA3[0].SALE_IND != null && rowDatad.RA3[0].SALE_IND != "") SALE_IND = parseInt(rowDatad.RA3[0].SALE_IND.toString().trim());

                                debugger;
                                if (rowDatad.RA2[0].R24_IND != null && rowDatad.RA2[0].R24_IND != "") R24_IND = parseInt(rowDatad.RA2[0].R24_IND.toString().trim());
                                if (rowDatad.RA2[0].L7_IND != null && rowDatad.RA2[0].L7_IND != "") B3_IND = parseInt(rowDatad.RA2[0].L7_IND.toString().trim());
                                if (rowDatad.RA2[0].PLAN_APPL_IND != null && rowDatad.RA2[0].PLAN_APPL_IND != "") PLAN_APPL_IND = parseInt(rowDatad.RA2[0].PLAN_APPL_IND.toString().trim());
                                if (rowDatad.RA2[0].A17_IND != null && rowDatad.RA2[0].A17_IND != "") TRAVEL_IND = parseInt(rowDatad.RA2[0].A17_IND.toString().trim());


                                if (rowDatad.RA[0].K_TAX != null && rowDatad.RA[0].K_TAX != "") K_TAX = parseInt(rowDatad.RA[0].K_TAX.toString().trim());
                                if (rowDatad.RA[0].COUNTRY_ID != null && rowDatad.RA[0].COUNTRY_ID != "") BASE_COUNTRY_ID = rowDatad.RA[0].COUNTRY_ID.toString().trim();

                                $("#CURRENCY_FORMAT").val(rowDatad.RA[0].CURRENCY_FORMAT);
                                $("#CURRENCY_DELIMIT").val(rowDatad.RA[0].CURRENCY_DELIMIT);
                                $("#CURRENCY_DECIMLIMIT").val(rowDatad.RA[0].CURRENCY_DECIMLIMIT);


                                $("#S14_IND").val(S14_IND);
                                $("#F11_IND").val(F11_IND);
                                $("#J14_IND").val(J14_IND);
                                $("#J2_IND").val(J2_IND);
                                $("#SALE_IND").val(SALE_IND);



                                $("#R24_IND").val(R24_IND);
                                $("#B3_IND").val(B3_IND);
                                $("#PLAN_APPL_IND").val(PLAN_APPL_IND);
                                $("#TRAVEL_IND").val(TRAVEL_IND);
                                $("#BASE_COUNTRY_ID").val(BASE_COUNTRY_ID);



                                debugger;
                                //if (R24_IND == 0) {
                                //    $$("ChkComplHU").setValue(0);                                    
                                //}
                                //else if (R24_IND == 1) {
                                //    $$("ChkComplHU").setValue(1);
                                    

                                //}
                                //else if (R24_IND == 2) {
                                //    $$("ChkComplHU").setValue(1);                                    

                                //}
                                //else if (R24_IND == 3) {
                                //    $$("ChkComplHU").setValue(0);
                                    
                                //}

                            }
                        }
                    });
                }
                catch (e) {
                    console.log(e.message)
                }
            };            
            function GridDesign() {
                webix.ui({
                    id: "gridRpt",
                    container: "gridRptt",
                    select: 'row',
                    view: "datatable",
                    fixedRowHeight: false,
                    rowLineHeight: 23,
                    autoConfig: true,
                    //autoheight:true,
                    resizeColumn: true,
                    resizeRow: true,
                    //height: 460,
                    //minWidth:900,
                    position: "flex",
                    css: "webix_header_border",
                    data: [],
                    columns: [
                            { id: "ixGNm", header:  "Guest", fillspace:1.5, minWidth:260, css: { 'text-align': 'left ! important' } },
                            { id: "ixTotVisits", header: "Total Visits",fillspace:1.1, minWidth:80, css: { 'text-align': 'right ! important' },hidden:true },
                            { id: "ixVisits", header:  "No of Visits", fillspace:1.1, minWidth:90, css: { 'text-align': 'right ! important' } },
                            { id: "ixNight", header: "Nights", fillspace:1.1, minWidth:50, css: { 'text-align': 'right ! important' } },
                            { id: "ixAvgStay", header: "Average Stay",fillspace:1.1, minWidth:100, css: { 'text-align': 'right ! important' } },
                            { id: "ixRev", header: "Revenue", fillspace:1.1, minWidth:100, css: { 'text-align': 'right ! important' } },
                            { id: "ixArr", header: "ADR", fillspace:1.1, minWidth:90, css: { 'text-align': 'right ! important' } },
                            { id: "ixGMob", header: "Mobile", fillspace:1.1, minWidth:100, css: { 'text-align': 'left ! important' } },
                            { id: "ixGPlace", header: "Place", fillspace:1.3, minWidth:100,  css: { 'text-align': 'left ! important' } },
                            { id: "ixGEMail", header: "EMail", fillspace:1.5, minWidth:110,  css: { 'text-align': 'left ! important' } },                            
                            { id: "ixGComp", header: "Company", fillspace:1.5, minWidth:130, css: { 'text-align': 'left ! important' } },
                            { id: "ixProperty", header: "Property", width: 100, css: { 'text-align': 'left ! important' } },
                            { id: "ixPNight", header: "Nights", width: 100, css: { 'text-align': 'right ! important' } },
                            { id: "ixPRev", header: "Revenue", width: 100, css: { 'text-align': 'right ! important' } },                            
                            { id: "CLR", hidden: true },
                    ],

                    scheme: {
                        $init: function (item) {
                            if (item.CLR != "" && item.CLR != null) {
                                item.$css = item.CLR;
                            }
                        },
                    },

                    on: {
                        onBeforeClose: function () {
                            return false;
                        },
                        onAfterload: function () {
                        }
                    },
                });
            };                        
            function loadOptionPopWindow() {
                webix.ui({
                    view: "window",
                    close: true,
                    modal: true,
                    id: "RptOptionsNew",
                    head: "Option",
                    position: "center",
                    css: "WebIxStyle",
                    height: 300,
                    width: 200,
                    move: true,                    
                    body: {
                        rows: [
                                {
                                    view: "scrollview", scroll: "y", height: 200, width: 300, body: {
                                        padding: { top: 10, left: 20, bottom: 10, right: 10 },
                                        rows: [
                                            
                                            { view: "checkbox", id: "chkMob", labelWidth: 5, labelRight: "Mobile", customCheckbox: false,  },
                                            { view: "checkbox", id: "chkPlace", labelWidth: 5, labelRight: "Place", customCheckbox: false,  },                                          
                                            { view: "checkbox", id: "chkEmail", labelWidth: 5, labelRight: "EMail", customCheckbox: false,  },
                                            { view: "checkbox", id: "chkCompany", labelWidth: 5, labelRight: "Company", customCheckbox: false,  },                                            

                                            { view: "text", id: "txtMob", hidden: true, },                                
                                            { view: "text", id: "txtPlace", hidden: true, },
                                            { view: "text", id: "txtEmail", hidden: true, }, 
                                            { view: "text", id: "txtCompany", hidden: true, },                                           
                                            
                                            
                                        ]
                                    }
                                },
                                {padding: { top: 5, right: 20 }, cols: [{}, { view: "button",css:"webix_primary", id: "Okoptions", label: "OK", inputWidth: 70, width: 70, click: function () { btnOkOptionClick(); } }], }
                        ]

                    }
                });
            };
            function btnOkOptionClick() {
                debugger;
                ClearGrid();
                $$("txtMob").setValue($$("chkMob").getValue());    
                $$("txtPlace").setValue($$("chkPlace").getValue());
                $$("txtEmail").setValue($$("chkEmail").getValue());  
                $$("txtCompany").setValue($$("chkCompany").getValue());                    
                fnShowColumn();
                $$("RptOptionsNew").hide();
            };
            function btnOptionClick() {
                if (fnChkSessVal() == false) return;                
                $$("chkMob").setValue($$("txtMob").getValue());    
                $$("chkPlace").setValue($$("txtPlace").getValue());
                $$("chkEmail").setValue($$("txtEmail").getValue());  
                $$("chkCompany").setValue($$("txtCompany").getValue());   
                
                $$("RptOptionsNew").show();
            };
            function fnChkSessVal() {
                debugger;
                var bVal = "0";
                $.ajax({
                    async: false,
                    url: "/Reports/fnChkSessionval",
                    type: 'POST',
                    success: function (data) {
                        debugger;
                        if (data == "1") {
                            bVal = "1";
                        }
                    },
                    error: function (request, status, error) {
                        bVal = "0";
                    }
                });
                if (bVal == "1") return true;
                else {
                    debugger;
                    var Host = window.location.host;
                    var LoadingUrl = "http://" + Host + "/Login.aspx";
                    window.location.href = LoadingUrl;
                }

            };
            function fnShowColumn() {
                debugger;                
                $$("gridRpt").hideColumn("ixGMob");
                $$("gridRpt").hideColumn("ixGPlace");
                $$("gridRpt").hideColumn("ixGEMail");
                $$("gridRpt").hideColumn("ixGComp");                
                
                if ($$("txtMob").getValue() == "1"){
                    $$("gridRpt").showColumn("ixGMob");                    
                }
                if($$("txtPlace").getValue()=="1"){
                    $$("gridRpt").showColumn("ixGPlace");                    
                } 
                
                if($$("txtEmail").getValue()=="1"){
                    $$("gridRpt").showColumn("ixGEMail");                    
                } 

                if($$("txtCompany").getValue()=="1"){
                    $$("gridRpt").showColumn("ixGComp");                    
                } 

            };
            function fnNumericText(code, e) {
                debugger;
                var charCode = e.which || e.keyCode;    
                if (charCode == 46 || charCode == 37 || charCode == 39) {
                    return true
                }
                if (charCode > 31 && (charCode < 48 || (charCode > 57 && (charCode < 96 || charCode > 105)))) {
                    return false;
                }
                else {
                    debugger;
                    return true;
                }
            };

            function fnRetComboVal(Obj,FldId){
                if(Obj.getValue() == "") return "";
                var RetVal = "";
                var Data =  Obj.getList().serialize();
                if(Data.length>0){
                    var newData = Data.filter(function (el) {
                        return el.id == Obj.getValue();
                    });
                    if (newData.length > 0) RetVal = newData[0][FldId].toString().trim();
            
                }

                return RetVal;
            };
            function fnGetDefaultComp(CompId){
                if(CompId.indexOf(",")>=0){
                    var vSplit= CompId.split(",");
                    var newData = vSplit.filter(function(el) {
                        return el.toString().trim().toUpperCase() == "WS";
                    });
                    if(newData.length>0) CompId=newData[0].toString().trim();
                    else CompId=vSplit[0].toString().trim();            
                } 
                return CompId;
            };

        </script>


        <script type="text/javascript">

            $("#LoadDIv").hide();
            $(document).on('shown.lte.pushmenu', function () {
                var timeoutID;
                function delayedStart() {
                    timeoutID = window.setTimeout(resizeAction, 350);
                }

                function resizeAction() {
                    sidebarFn(1);
                    //  alert("Sidebar is collapsed or expanded!")
                    window.clearTimeout(timeoutID);
                }

                delayedStart();

            }).on('collapsed.lte.pushmenu', function () {
                var timeoutID;
                function delayedStart() {
                    timeoutID = window.setTimeout(resizeAction, 350);
                }

                function resizeAction() {
                    sidebarFn(2);
                    //  alert("Sidebar is collapsed or expanded!")
                    window.clearTimeout(timeoutID);
                }

                delayedStart();
            });
            function  sidebarFn(val){
                //var rowDatad = $$("gridRpt").serialize();

                //if ($$("gridRpt"))
                //    $$("gridRpt").destructor();

                //fnHeader();
                //$$("gridRpt").clearAll();
                //$$("gridRpt").parse(rowDatad);
                //$$("gridRpt").show();
                $$("gridRpt").resize();
            }
            function fnExcelExport() {
                debugger;
                var vHeader = $("#lblRptCaption").text();
                var FullData = "";

                FullData = $$("gridRpt").serialize();
                var len = FullData.length;
                if (len > 0) {
                    webix.toExcel($$("gridRpt"), {
                        filename: vHeader,
                        styles: true,
                        name: vHeader,
                        docHeader: vHeader,
                        rawValues: true,
                    });
                }
                else {
                    alert("Records not present in Report");
                }

            };
            function fnGridPrint() {
                debugger;
                var vHeader = $("#lblRptCaption").text();
                var FullData = "";

                FullData = $$("gridRpt").serialize();
                var len = FullData.length;
                if (len > 0) {
                    webix.print($$("gridRpt"), {
                        docHeader: { text: vHeader, fontSize: 25 },
                        fit: "page",
                        scroll: false,
                        mode: "landscape"
                    });
                }
                else {
                    alert("Records not present in Report");
                }


            };

            

            function fnChkComplHUClick() {
                ClearGrid();
            };
            //function fnChkDayUseClick() {
            //    ClearGrid();
            //};
            //function fnChkDaywsClick() {
            //    debugger;
            //    ClearGrid();
            //    fnChkMonthwsClick();

            //};
            //function fnChkQuartClick() {
            //    ClearGrid();

            //    fnChkMonthwsClick();

            //};
            function ClearGrid() {
                $$("gridRpt").clearAll();
            };
            function fnbtnDisplay() {
                debugger;
                ClearGrid();
                $("#LoadDIv").show();
                var frmdate = "";
                var todate = "";              
                
                var frmdate = $$("FromDt").getText();
                var todate = $$("ToDt").getText();
                var CHKDAYTP = "";
                
                if (frmdate == "") {
                    webix.message("From Date can't be empty", "warning", 500);
                    $("#LoadDIv").hide();
                    return;
                }
                if (todate == "") {
                    webix.message("To Date can't be empty", "warning", 500);
                    $("#LoadDIv").hide();
                    return;
                }
                
                var bSucc = "1";                
                //var comp = $$("Property").getValue();
                var comp = fnRetComboVal($$("Property"),"ORGID");        
                var CompTy = fnRetComboVal($$("Property"),"TYPE");
                var comp1 = comp;
                if(CompTy == "2") comp = fnGetDefaultComp(comp) ;                
                if (comp == "") {
                    webix.message("Property can't be empty", "warning", 500);
                    $("#LoadDIv").hide();
                    return;
                }              

                //SEGTYPE = $$("ddlSeg").getText();
                //// CHKREVPAR = $$("ChkRevPar").getValue();

                var FVISITS = "0";

                FVISITS = $$("txtVisits").getValue();

                var OPTCOUNTRY = "0";
                var OPTNATION = "0";

                var OptGroup = $$("OptGroup").getValue();
                if(OptGroup == "1") OPTCOUNTRY ="1";
                else if(OptGroup == "2") OPTNATION ="1";
                
                var Request = {
                    REQTYPE: "GET_FNFOREPEATGST",
                    COMPID: comp,
                    FROMDT:frmdate,
                    TODT:todate,                    
                    MultiCompID:comp1,    
                    OPTCOUNTRY:OPTCOUNTRY,
                    OPTNATION:OPTNATION,
                    FVISITS:FVISITS

                }
                var Currfrmt = $("#CURRENCY_FORMAT").val();
                var CurrDelimit = $("#CURRENCY_DELIMIT").val();
                var CurrDecimal = $("#CURRENCY_DECIMLIMIT").val();
                var dataparam = JSON.stringify(Request);
                $.ajax({
                    async: true,
                    url: "/Reports/FOAPI_CALL",
                    type: 'POST',
                    data: "request=" + dataparam,
                    success: function (data) {
                        debugger;
                        if (data != "") {
                            var rowDatad = JSON.parse(data);
                            $$("gridRpt").clearAll();
                            $$("gridRpt").parse(rowDatad);
                        }

                    },
                    error: function (err) {
                        $("#LoadDIv").hide();
                    },
                    complete: function () {
                        debugger;
                        $("#LoadDIv").hide();
                    }
                });
            };
            function formatDate(StrDt) {
                //debugger;
                var Parts = StrDt.split(" ");
                var MN = FnRetMonth(Parts[0]);
                var YR = Parts[1];
                var Str = "01" + "/" + MN + "/" + YR;
                return Str;
            };
            function FnRetMonth(StrMnNm) {
                //debugger;
                var UStr = StrMnNm.toUpperCase();
                var str = "";

                switch (UStr) {
                    case "JAN": str = "01"; break;
                    case "FEB": str = "02"; break;
                    case "MAR": str = "03"; break;
                    case "APR": str = "04"; break;
                    case "MAY": str = "05"; break;
                    case "JUN": str = "06"; break;
                    case "JUL": str = "07"; break;
                    case "AUG": str = "08"; break;
                    case "SEP": str = "09"; break;
                    case "OCT": str = "10"; break;
                    case "NOV": str = "11"; break;
                    case "DEC": str = "12"; break;
                }

                return str;
            };
            function FnRetMonth1(intMn) {
                //debugger;

                var str = "";

                switch (intMn) {
                    case 1: str = "Jan"; break;
                    case 2: str = "Feb"; break;
                    case 3: str = "Mar"; break;
                    case 4: str = "Apr"; break;
                    case 5: str = "May"; break;
                    case 6: str = "Jun"; break;
                    case 7: str = "Jul"; break;
                    case 8: str = "Aug"; break;
                    case 9: str = "Sep"; break;
                    case 10: str = "Oct"; break;
                    case 11: str = "Nov"; break;
                    case 12: str = "Dec"; break;
                }

                return str;
            };
            function ExcelFormat() {
                debugger;
                return //"#,##0.00",
            };
           

           
            function SMToDateChange(e) {
                debugger;
                var frmdate = $$("FromDt").getText();
                var todate = $$("ToDt").getText();
                var sFrmDt = $$("ToDt").getText();
                var vAccDt = $("#HdnAccDt").val();

                var bSucc = "1";

                if (frmdate == "") {
                    webix.message("From Date can't be empty", "warning", 800);
                    $("#LoadDIv").hide();
                    bSucc = "0";
                    return bSucc;
                }


                if (todate == "") {
                    webix.message("To Date can't be empty", "warning", 800);
                    $("#LoadDIv").hide();
                    bSucc = "0";
                    return bSucc;
                }

                $.ajax({
                    type: "POST",
                    url: "/Reports/FTDateValidation",
                    cache: false,
                    async: false,
                    charset: 'utf-8',
                    data: "F=" +  frmdate + "&T=" + todate,
                    success: function (data) {
                        if (data.d != "") {
                            debugger;
                            //webix.message("From Month Should be less than To Month ", "warning", 500);
                            $("#LoadDIv").hide();
                            //$$("ToMthDate").setValue(FrmMnth);
                            var vToDt = formatDate1(sFrmDt);
                            $$("FromDt").setValue(new Date(vToDt));
                            //bSucc = "0";
                        }
                    }
                });


                $.ajax({
                    type: "POST",
                    url: "/Reports/FTDateValidation",
                    cache: false,
                    async: false,
                    charset: 'utf-8',
                    data: "F=" + todate  + "&T=" + vAccDt,
                    success: function (data) {
                        if (data.d != "") {
                            debugger;
                            //webix.message("From Month Should be less than To Month ", "warning", 500);
                            $("#LoadDIv").hide();
                            //$$("FromDt").setValue(vAccDt);
                            var vFromDt = formatDate1(vAccDt);
                            $$("ToDt").setValue(new Date(vFromDt));


                            //bSucc = "0";
                        }
                    }
                });

                return bSucc;
            }


            function SMFromDateChange(e) {
                debugger;
                var frmdate = $$("FromDt").getText();
                var todate = $$("ToDt").getText();
                var sFrmDt = $$("FromDt").getText();
                var vAccDt = $("#HdnAccDt").val();

                var bSucc = "1";

                if (frmdate == "") {
                    webix.message("From Date can't be empty", "warning", 800);
                    $("#LoadDIv").hide();
                    bSucc = "0";
                    return bSucc;
                }


                if (todate == "") {
                    webix.message("To Date can't be empty", "warning", 800);
                    $("#LoadDIv").hide();
                    bSucc = "0";
                    return bSucc;
                }

                $.ajax({
                    type: "POST",
                    url: "/Reports/FTDateValidation",
                    cache: false,
                    async: false,
                    charset: 'utf-8',
                    data: "F=" + frmdate + "&T=" + todate,
                    success: function (data) {
                        if (data.d != "") {
                            debugger;
                            //webix.message("From Month Should be less than To Month ", "warning", 500);
                            $("#LoadDIv").hide();
                            //$$("ToMthDate").setValue(FrmMnth);
                            var vToDt = formatDate1(sFrmDt);
                            $$("ToDt").setValue(new Date(vToDt));
                            //bSucc = "0";
                        }
                    }
                });


                $.ajax({
                    type: "POST",
                    url: "/Reports/FTDateValidation",
                    cache: false,
                    async: false,
                    charset: 'utf-8',
                    data: "F=" + frmdate  + "&T=" + vAccDt,
                    success: function (data) {
                        if (data.d != "") {
                            debugger;
                            //webix.message("From Month Should be less than To Month ", "warning", 500);
                            $("#LoadDIv").hide();
                            //$$("FromDt").setValue(vAccDt);
                            var vFromDt = formatDate1(vAccDt);
                            $$("FromDt").setValue(new Date(vFromDt));


                            //bSucc = "0";
                        }
                    }
                });

                return bSucc;

            }


        </script>
    </section>
</div>
