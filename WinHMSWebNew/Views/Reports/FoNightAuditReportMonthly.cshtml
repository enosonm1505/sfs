@{
    ViewBag.Title = "Night Audit Report - Monthly";
    //Layout = "~/Views/Shared/Layout/Fo_ReportLayout.cshtml";
    if (ViewBag.VMD == "MST") { Layout = "~/Views/Shared/Layout/Mst_FoReportLayout.cshtml"; }
    else { Layout = "~/Views/Shared/Layout/Fo_ReportLayout.cshtml"; }
}

<script src="../../Scripts/xlExport.js"></script>
<div class="content-wrapper">
    <section class=" col-xl-12 col-md-12 col-sm-12 themedes p-0 ">
        <link href="../../Content/Contribute.css" rel="stylesheet" />
        <link href="../../Content/bootstrap-4.4.1-dist/css/bootstrap.min.css" rel="stylesheet" />
        <link href="~/Content/sidemenu-webix.css" rel="stylesheet" />
        <link href="~/FO/CSS/sidemenu-custom.css" rel="stylesheet" />
        <link href="../../Content/xlExportCss.css" rel="stylesheet" />
        <div id="divPage">
            <div class="container-fluid">

                <div class="row new_hdr">
                    <div class="col-sm-3">

                        <div class="TextWidth" id="divPropbox">
                        </div>
                    </div>
                    <div class="col-sm-5 text-center">

                        <label class="wc_hdr_tlt" id="lblRptCaption"> Night Audit Report - Monthly </label>

                    </div>
                    @*<div class="col-sm-4">
                            <div class="card-tools text-right">
                                <button type="button" class="btn btn-custom" id="btnPrint" title="Print" onclick="fnGridPrint()"><i class='fas fa-print'></i></button>
                                <button type="button" class="btn btn-custom" id="btnExcel" title="Excel Export" onclick="fnExcelExport()"><i class="far fa-file-excel"></i></button>

                            </div>
                        </div>*@

                    <div class="col-sm-4">
                        <div class="card-tools text-right">
                            <div id="divPrint" class="btnXX"></div>
                            <div id="divExcel" class="btnXX"></div>
                        </div>
                    </div>


                </div>

                <div style="border:solid transparent;" class="row">                    
                    <div class="col-xl-4 col-md-4 col-lg-4 col-xs-0">

                    </div>

                    <div class="col-xl-3 col-md-5 col-lg-3 col-sm-3 ">
                        <div class="row">
                            <div class="col-md-9 ">
                                <div id="divFromDt"></div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-9">
                                <div id="divToDt"></div>
                            </div>
                            <div class="col-md-3  pr-0">
                                <div id="divbtnDisp"></div>
                            </div>
                        </div>
                    </div>

                    <div class="col-xl-2 col-md-3 col-lg-2 col-xs-11">
                        <div class="row" style="height: 25px">
                            <div class="col-sm-12 ">
                                <div id="divchkLast"> </div>
                            </div>
                        </div>
                    </div>                   

                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <div id="divGrid" style="width: 100%; height: 460px"></div>

                    </div>
                </div>

            </div>
        </div>

        <input type="hidden" id="HdnCurrDt" />
        <input type="hidden" id="HdnCurrMnth" />
        <input type="hidden" id="HdnAccDt" />
        <input type="hidden" id="HdnToAccDt" />
        <input type="hidden" id="HdnAccMnth" />
        <input type="hidden" id="HdnFrmMnth" />
        <input type="hidden" id="HdnToMnth" />
        <input type="hidden" id="HdnYrFrmMnth" />
        <input type="hidden" id="HdnYrToMnth" />

        <style>
            .btn-custom1 {
                color: #000;
                background-color: #ffffff;
                /* border-color: #cccccc; */
                background: transparent;
                padding: 0px 8px;
                font-size: 18px;
                color: #0798af;
                height: 25px !important;
                border: none !important;
            }

            .btnXX {
                display: inline-block;
                text-align: center;
                vertical-align: middle;
                line-height: 1.5;
            }

            .btn-custom {
                color: #000;
                background-color: #ffffff;
                /* border-color: #cccccc; */
                background: transparent;
                padding: 2px 4px;
                font-size: 18px;
                color: #0798af;
                white-space: nowrap;
            }

                .btn-custom:hover {
                    color: white !important;
                    background-color: rgb(40, 132, 179);
                    border-color: #cccccc;
                    /* padding: 3px 7px; */
                }

                .btn-custom > i {
                    padding-left: 5px;
                }

            .btn-custom1 {
                color: #000;
                background-color: #ffffff;
                /* border-color: #cccccc; */
                background: transparent;
                padding: 0px 8px;
                font-size: 18px;
                color: #0798af;
                height: 25px !important;
                border: none !important;
            }

            .GrpTot1 {
                color: black;
                font-weight: Bold;
                font-family: Arial !important;
            }

            .GrpTotBAckCol {
                background-color: #eaeaea !important;
                color: #16888e !important;
                font-weight: Bold !important;
                font-family: Arial !important;
            }

            .MyDb .webix_cell.webix_dtable_colrow {
                background-color: #3b99b5 !important;
                color: white !important;
            }

            .GrpHead {
                color: black;
                font-weight: Bold;
                font-family: Arial !important;
            }
        </style>

        @*Topmenu Style ends*@
        <style>
            .Pagefalse {
                pointer-events: none;
                opacity: 0.6;
            }

            .btn-filter .webix_button {
                border: none !important;
                background: none !important;
            }

            .btn-option .webix_icon_btn {
                font-weight: normal !important;
            }

            .lstYrStyle .webix_hcell {
                background: #009966 !important;
                color: white !important;
            }
        </style>

        <script>
            function fnCurrDtTime() {
                var vDate = "";
                var vTime = "";
                var rowData = [];
                var CompId = $$("Property").getValue();
                Request = {
                    REQTYPE: "GET_FNLOADCURRDTTM",
                    COMPID: CompId,
                }
                var DataVal = JSON.stringify(Request);
                $.ajax({
                    async: false,
                    url: "/Reports/FOAPI_CALL",
                    type: 'POST',
                    data: "request=" + DataVal,
                    success: function (d) {
                        debugger;
                        if (d != "") {
                            rowData = JSON.parse(d);
                            vDate = rowData.GDate;
                            vTime = rowData.GTime;

                        }
                    },
                });

                return [vDate, vTime];

            };

            function fnExcelExport() {
                var vGrid = "";
                var CompId = $$("Property").getValue();        
                vGrid = $$("gridRpt");

                var CompNm = $$("Property").getText();                
                var values = fnCurrDtTime();
                var vDate = values[0];
                var vTm = values[1];
                
                var FromDt = $$("FromDt").getText();
                var ToDt = $$("ToDt").getText();

                var vHeader = $("#lblRptCaption").text();
                var FullData = "";
                FullData = vGrid.serialize();
                var len = FullData.length;
                if (len > 0) {
                    var vExpoartGrid = webix.copy($$("gridRpt"),-1);                               
                    fnComExcelExport(vExpoartGrid,vHeader,vHeader,true,CompNm,vDate,vTm,FromDt,ToDt,"");
                    //webix.toExcel(vGrid, {
                    //    filename: vHeader,
                    //    styles: true,
                    //    spans: true,
                    //    name: vHeader,
                    //    docHeader: "<div class='row'><div class='col-4 col-sm-4  text-left' style='font-weight:bold !important'>" + CompNm + "</div>" + "<div class='col-4 col-sm-4  text-center' style='text-align:center !important;font-weight:bold !important'>" + vHeader + "</div></div>" + "<div class='row'>" + "<div class='col-12 col-sm-12 text-center'> AsOn : " + AsOn + "</div></div>",
                    //    rawValues: true,
                
                    //});
                }
                else {
                    alert("Records not present in Report");
                }


            };
            function fnGridPrint() {
                debugger;
                var vHeader = $("#lblRptCaption").text();
                var FullData = "";
                var vGrid = "";
                var CompId = $$("Property").getValue();
                vGrid = $$("gridRpt");

                var CompNm = $$("Property").getText();                                
                var FromDt = $$("FromDt").getText();
                var ToDt = $$("ToDt").getText();                
                DocHeader = "<div class='row'><div class='col-4 col-sm-4  text-left' style='font-weight:bold !important'>" + CompNm + "</div>" + "<div class='col-4 col-sm-4  text-center' style='text-align:center !important;font-weight:bold !important'>" + vHeader + "</div></div>" + "<div class='row'>" + "<div class='col-12 col-sm-12 text-center'> From: " + FromDt + "   To: " + ToDt + "</div></div>"; 
                FullData = vGrid.serialize();
                var len = FullData.length;
                if (len > 0) {
                    webix.print(vGrid, {
                        docHeader: DocHeader,
                        fit: "page",
                        scroll: false,
                        mode: "landscape"
                    });
                }
                else {
                    alert("Records not present in Report");
                }

            };

            $(document).ready(function () {

                var Print = "<span  class='wc_fnt18 fas fa-1x  fa-print'></span>";
                var excel = "<span  class=' wc_fnt18 far fa-1x fa-file-excel'></span>";

                $("#MenuName").val('FOMNUNANAREPMON');
                $("#MenuLvl").val('FOMNUNA');
                $("#MenuLvl1").val('');

                webix.ready(function () {
                    debugger;

                    GridDesign();


                    webix.ui({
                        view: "button", id: "Print", value: "Print", width: 70, container: "divPrint", label: Print, tooltip: true,
                        on: {
                            onItemClick: function () {
                                fnGridPrint();
                            }
                        }
                    });

                    webix.ui({
                        view: "button", id: "Excel", value: "Excel", width: 70, container: "divExcel", label: excel, tooltip: true,
                        on: {
                            onItemClick: function () {
                                fnExcelExport();

                            }
                        }
                    });


                    webix.ui({container: "divPropbox",view: "richselect", id: "Property",on: {onChange: function (newVal,OldVal) {fnPropChange(newVal,"1");}}});
                    webix.ui({
                        container: "divFromDt", view: "datepicker", name: "FromDt", id: "FromDt", format: "%M %Y", type: "month", stringResult: true, label: "From", labelWidth: 50,
                        on: {
                            onChange: function () {
                                $$("gridRpt").clearAll();
                                var frmdate = $$("FromDt").getValue();
                                var todate = $$("ToDt").getValue();
                                if (frmdate != "" && todate != "") SMFromDateChange();
                            }
                        }
                    });
                    webix.ui({
                        container: "divToDt", view: "datepicker", name: "ToDt", id: "ToDt", format: "%M %Y", type: "month",  stringResult: true, label: "To", labelWidth: 50,
                        on: {
                            onChange: function () {
                                $$("gridRpt").clearAll();
                                var frmdate = $$("FromDt").getValue();
                                var todate = $$("ToDt").getValue();
                                if (frmdate != "" && todate != "") SMToDateChange();
                            }
                        }
                    });

                    webix.ui({ container: "divbtnDisp", view: "button",css:"webix_primary", id: "btnDisplay", icon: "wxi-check", label: "Display", inputWidth: 60, width: 60, click: function () { fnLoadGrid(); } }),

                    webix.ui({ container: "divchkLast", view: "checkbox", id: "chkLast", labelWidth: 120, label: "Compare Last Year", customCheckbox: false, click: function () { fnchkLastClick(1); }, });
                    var cmpid= @Html.Raw(Json.Encode(ViewBag.COMP));
                    LoadProperty(cmpid);

                    var propchk = @Html.Raw(Json.Encode(ViewBag.MLTPROPHISHIND));
                    if (propchk == "1") $("#divPropbox").show();
                    else if (propchk == "0") $("#divPropbox").hide();

                    gridResize();
                });

                webix.event(window, "resize", function () {
                    gridResize();
                })
                

            });

            function gridResize(){
                //debugger;
                var vheight = window.innerHeight
                       || document.documentElement.clientHeight
                       || document.body.clientHeight;
                var offset =  $("#divGrid").offset();

                
                $$("gridRpt").define("height", ((vheight - offset.top-50)));
                $$("gridRpt").adjust();
                      

            }


            function LoadProperty(cmpid) {
                debugger;
                Request = {
                    REQTYPE: "GET_PROPERTYLOAD",
                    COMPID: cmpid,
                }
                Prop_Id = cmpid;
                var rowData = [];
                var options =[];

                var DataVal = JSON.stringify(Request);
                $.ajax({
                    async: false,
                    url: "/Reports/FOAPI_CALL",
                    type: 'POST',
                    data: "request=" + DataVal,
                    success: function (d) {
                        debugger;
                        if (d != "") {
                            rowData = JSON.parse(d);
                            $$("Property").define("options",rowData);
                            $$("Property").refresh();
                            $$("Property").setValue(Prop_Id);

                        }
                    },
                });
            }

            function GridDesign() {
                webix.ui({
                    id: "gridRpt",
                    container: "divGrid",
                    select: 'row',
                    view: "datatable",
                    fixedRowHeight: false,
                    rowLineHeight: 23,
                    resizeColumn:true,
                    autoConfig: true,
                    editable: true,
                    spans: true,
                    height: 420,
                    minWidth:900,
                    position: "flex",
                    css: "webix_header_border",
                    data: [],

                    columns: [
                        { id: "PARTICULARS", header: 'Particulars', width: 300, css: { 'text-align': 'left ! important', }, },

                    ],
                    data: [],
                    scheme: {
                        $init: function (item) {
                            if (item.CLR != "" && item.CLR != null) {
                                var Columns = $$('gridRpt').config.columns;
                                var ColCnt = Columns.length;
                                if (item.CLR == "GrpHead") {
                                    debugger;
                                    $$("gridRpt").addSpan(item.id, "PARTICULARS", ColCnt, 1, null, "GrpHead");
                                    $$("gridRpt").refresh();
                                }
                                else item.$css = item.CLR;
                            }
                        },
                        $export: function (obj) {
                            debugger;                
                            var item = webix.copy(obj);
                                               
                            if (item.CLR != "ExcelHead") {                        
                                $.each(obj, function (key, value) {
                                    debugger;
                                    ColId = key;
                                    if(ColId != "PARTICULARS" && ColId != "REV_GR1_ID" && ColId != "CLR" && ColId != "SEQ_NO1" && ColId != "id" && ColId != "HIDD"){
                                        var vBal = value; 
                                        if (vBal != null && vBal != undefined && vBal != "") {
                                            var vBal1 =  vBal.replace(/[,]/g, '');                                  
                                            vBal1 = parseFloat(vBal1);                                
                                            item[ColId] = vBal1;
                                        }   
                                    }
                                })                            
                            }
                            return item;
                        },
                    },
                    

                    on: {
                        onBeforeClose: function () {
                            return false;
                        },
                    }
                });
            }

            function fnPropChange(CompId,vLoad){
                debugger;
                window.BASE_CURRENCY = "";
                window.CURR_DT = "";
                window.M_TAX = "";
                window.IT_NO ="";
                window.CURRENCY_FORMAT = "";
                window.CURRENCY_DELIMIT = "";
                window.CURRENCY_DECIMLIMIT = "";
                window.Q25_Ind="";
                window.CPN_MODE_RES="";
                window.PROPCHANGE="1";

                LoadInds(CompId);

                debugger;
                $$("chkLast").setValue("0");

                LoadDate(CompId);
                fnHeader();
            };

            var LoadInds = function (CompId) {
                debugger;
                //var  JSON.parse(request);

                window.BASE_CURRENCY = "";
                window.CURR_DT = "";

                window.CURRENCY_FORMAT = "";
                window.CURRENCY_DELIMIT = "";
                window.CURRENCY_DECIMLIMIT = "";
                window.IT_NO = "";
                window.CPN_MODE_RES = "";
                Window.E15_IND = "";
                Window.H11_IND = "";
                Window.R11_IND = "";
                Window.RR_IND = "";

                window.Q25_Ind = "";
                window.J15_IND = "";

                Request = {
                    REQTYPE: "GET_FNGETLOADCONT",
                    COMPID: CompId,
                }

                var rowData = [];
                var options = [];
                var dataparam = JSON.stringify(Request);

                $.ajax({
                    async: false,
                    url: "/Reports/FOAPI_CALL",
                    type: 'POST',
                    data: "request=" + dataparam,
                    success: function (d) {
                        debugger;
                        var Detemp = JSON.parse(d);
                        window.BASE_CURRENCY = Detemp.RA[0].BASE_CURRENCY_ID.toString().trim();
                        window.CURR_DT = Detemp.RA[0].CURDT1;

                        window.CURRENCY_FORMAT = Detemp.RA[0].CURRENCY_FORMAT;
                        window.CURRENCY_DELIMIT = Detemp.RA[0].CURRENCY_DELIMIT;
                        window.CURRENCY_DECIMLIMIT = Detemp.RA[0].VAL_DECIM_LIMIT;
                        window.IT_NO = Detemp.RA[0].IT_NO;
                        window.CPN_MODE_RES = Detemp.RA[0].CPN_MODE_RES;

                        window.Q25_Ind = Detemp.RA2[0].Q25_IND;
                        window.J15_IND = Detemp.RA3[0].J15_IND;
                        Window.E15_IND = Detemp.RA3[0].E15_IND;
                        Window.H11_IND = Detemp.RA3[0].H11_IND;
                        Window.R11_IND = Detemp.RA3[0].R11_IND;
                        Window.RR_IND = Detemp.RA3[0].RR_IND;

                    },
                    error: function (request, status, error) {
                        console.log("Error Failrue");
                    }
                });

            };
            function LoadDate(cmpid) {
                debugger;

                Request = {
                    REQTYPE: "GET_FRMMNTHTOMNTH",
                    COMPID: cmpid,
                }

                var DataVal = JSON.stringify(Request);

                $.ajax({
                    async: false,
                    url: "/Reports/FOAPI_CALL",
                    type: 'POST',
                    data: "request=" + DataVal,

                    success: function (data) {
                        debugger;
                        var data1 = JSON.parse(data);
                        var vCurrDt = data1[0].CURRDT.toString().trim();
                        var vAccDt = data1[0].ACC_DT2.toString().trim();
                        var vToAccDt = data1[0].TO_ACC_DT2.toString().trim();
                        var vAccMnth = data1[0].ACC_MNTH.toString().trim();
                        var vFromMnth = data1[0].FRMMNTH.toString().trim();
                        var vToMnth = data1[0].TOMNTH.toString().trim();

                        $("#HdnCurrDt").val(vCurrDt);
                        $("#HdnAccDt").val(vAccDt);
                        $("#HdnToAccDt").val(vAccDt);
                        $("#HdnAccMnth").val(vAccMnth);
                        $("#HdnFrmMnth").val(vFromMnth);
                        $("#HdnToMnth").val(vToMnth);


                        $$("FromDt").setValue(vFromMnth);
                        $$("ToDt").setValue(vToMnth);

                    },
                });
            };

            function fnLoadGrid() {
                //debugger;
                if (fnChkSessVal() == false) return;

                $$("gridRpt").clearAll();

                $("#pageloaddiv").show();
                //debugger;

                CompId = $$("Property").getValue();
                var FromDt = $$("FromDt").getValue();
                var ToDt = $$("ToDt").getValue();


                if (FromDt == "" || ToDt == "") return;

                if (FromDt != "") FromDt = formatDate(FromDt.substring(0, 10));
                if (ToDt != "") ToDt = formatDate(ToDt.substring(0, 10));
                var J15_Ind = window.J15_IND;
                var ChkLast = $$("chkLast").getValue();


                Request = {
                    REQTYPE: "GET_FNNARPTMONTHLY",
                    COMPID: CompId,
                    FROMDT: FromDt,
                    TODT: ToDt,                    
                    CHKLAST: ChkLast,
                }

                var rowData = [];
                requestData = JSON.stringify(Request);
                requestData = encodeURIComponent(requestData);
                $.ajax({
                    async: true,
                    url: "/Reports/FOAPI_CALL",
                    type: 'POST',
                    data: "request=" + requestData,
                    success: function (data) {
                        debugger;
                        if (data != "") {
                            $$("gridRpt").clearAll();
                            rowData = JSON.parse(data);
                            Rows = [];
                            $$("gridRpt").parse(rowData);

                            var vId = $$("gridRpt").getFirstId();                            

                        }
                        else $("#pageloaddiv").hide();
                    },
                    complete: function () {
                        $("#pageloaddiv").hide();
                    },
                    error: function (request, status, error) {
                        console.log("Error Failure");
                        $("#pageloaddiv").hide();
                    }
                });
            };

            function formatDate(StrDt) {
                //debugger;
                var Parts = StrDt.split(" ");
                var MN = FnRetMonth(Parts[0]);
                var YR = Parts[1];
                var Str = "01" + "/" + MN + "/" + YR;
                return Str;
            }
            function formatDate1(StrDt) {
                debugger;
                var Parts = StrDt.split("-");
                var Yr = Parts[0];
                var Mn = Parts[1];
                var Dt = Parts[2];
                var Str = Dt + "/" + Mn + "/" + Yr;
                return Str;
            };

            function formatDate2(StrDt) {
                debugger;
                var Parts = StrDt.split("/");
                var Yr = Parts[2];
                var Mn = FnRetMonth1(Parts[1]);;
                var Dt = Parts[0];
                var Str =  Mn + " " + Yr;
                return Str;
            };

            function FnRetMonth(StrMnNm) {
                //debugger;
                var UStr = StrMnNm.toUpperCase();
                var str = "";

                switch (UStr) {
                    case "JAN": str = "01"; break;
                    case "FEB": str = "02"; break;
                    case "MAR": str = "03"; break;
                    case "APR": str = "04"; break;
                    case "MAY": str = "05"; break;
                    case "JUN": str = "06"; break;
                    case "JUL": str = "07"; break;
                    case "AUG": str = "08"; break;
                    case "SEP": str = "09"; break;
                    case "OCT": str = "10"; break;
                    case "NOV": str = "11"; break;
                    case "DEC": str = "12"; break;
                }

                return str;
            }

            function FnRetMonth1(StrMnNm) {
                //debugger;
                var UStr = StrMnNm.toUpperCase();
                var str = "";

                switch (UStr) {
                    case "01": str = "JAN"; break;
                    case "02": str = "FEB"; break;
                    case "03": str = "MAR"; break;
                    case "04": str = "APR"; break;
                    case "05": str = "MAY"; break;
                    case "06": str = "JUN"; break;
                    case "07": str = "JUL"; break;
                    case "08": str = "AUG"; break;
                    case "09": str = "SEP"; break;
                    case "10": str = "OCT"; break;
                    case "11": str = "NOV"; break;
                    case "12": str = "DEC"; break;
                }

                return str;
            }


            function fnchkLastClick(vLoad) {
                debugger;

                fnHeader();

            };

            function fnHeader() {
                debugger;
                $$("gridRpt").destructor();
                GridDesign();
                var vCmpId = $$("Property").getValue();

                try {
                    var frmdate = $$("FromDt").getValue();
                    var todate = $$("ToDt").getValue()
                    debugger;
                    frmdate = formatDate(frmdate);
                    todate = formatDate(todate);
                    var chkLstYr =  $$("chkLast").getValue();

                    Request = {
                        REQTYPE: "GET_FNMONTHBETWNTWODT",
                        COMPID: vCmpId,
                        FROMDT:frmdate,
                        TODT:todate,
                        CHKLSTYR:chkLstYr,
                    }

                    var dataparam = JSON.stringify(Request);

                    var vColumn = $$("gridRpt").config.columns;
                    var vCnt = 0;
                    $.ajax({
                        async: false,
                        url: "/Reports/FOAPI_CALL",
                        type: 'POST',
                        data: "request=" + dataparam,
                        success: function (d) {
                            debugger;
                            rowData = JSON.parse(d);
                            if (rowData.length > 0) {

                                $.each(rowData, function (key, value) {
                                    debugger;
                                    var Hdr = value.MNTH_NM.toString();
                                    var MnthId = $.trim(value.MNTH_ID);
                                    var MType = $.trim(value.MTYPE);
                                    var vCss = "";
                                    var vWidth = 100;
                                    if(MType == "1" )
                                    {
                                        var set = {
                                            id: $.trim(MnthId) , header:{text: Hdr}, width: vWidth, css: { 'text-align': 'right ! important' },
                                            exportType: "number",exportFormat: "#,##0.00",
                                        };
                                        vColumn.push(set);
                                        vCnt += 1;

                                    }
                                    else
                                    {
                                        var set = {
                                            id: $.trim(MnthId) , header:{text: Hdr,css: {"background": "#d63855 !important;", "color": "white !important;" }}, width: vWidth, css: { 'text-align': 'right ! important' },
                                            exportType: "number",exportFormat: "#,##0.00",
                                        };
                                        vColumn.push(set);

                                    }


                                });
                                if(vCnt>1)
                                {
                                    var set = {
                                        id: "TOT" , header:"Total", width: 100, css: { 'text-align': 'right ! important' },
                                        exportType: "number",exportFormat: "#,##0.00",
                                    };
                                    vColumn.push(set);

                                    if(chkLstYr == "1"){
                                        set = {
                                            id: "PRVTOT" , header:{text: "Last Yr Total",css: {"background": "#d63855 !important;", "color": "white !important;" }},  width: 100, css: { 'text-align': 'right ! important' },
                                            exportType: "number",exportFormat: "#,##0.00",
                                        };
                                        vColumn.push(set);
                                    }
                                }
                                $$("gridRpt").refreshColumns();
                            }
                        }
                    });
                }
                catch (e) {
                    console.log(e.message)
                }

                gridResize();

            };

            function fngetLastYrDt(vDate){
                var vTo = "";
                var CompId = $$("Property").getValue();
                var Request = {
                    REQTYPE: "GET_FNRETDATEADD",
                    COMPID: CompId,
                    DATE: vDate,
                    DAYS: -1,
                    FORMAT: "Y",

                }

                var rowData = "";
                requestData = JSON.stringify(Request);
                requestData = encodeURIComponent(requestData);
                $.ajax({
                    async: false,
                    url: "/Reports/FOAPI_CALL",
                    type: 'POST',
                    data: "request=" + requestData,
                    success: function (data) {
                        debugger;
                        if (data != "") {
                            rowData = JSON.parse(data);
                            vTo = rowData;
                        }
                    },
                    error: function (request, status, error) {
                        console.log("Error Failure");
                    }
                })

                return vTo;


            }


            function fnChkSessVal() {
                debugger;
                var bVal = "0";
                $.ajax({
                    async: false,
                    url: "/Reports/fnChkSessionval",
                    type: 'POST',
                    success: function (data) {
                        debugger;
                        if (data == "1") {
                            bVal = "1";
                        }
                    },
                    error: function (request, status, error) {
                        bVal = "0";
                    }
                });
                if (bVal == "1") return true;
                else {
                    debugger;
                    var Host = window.location.host;
                    var LoadingUrl = "http://" + Host + "/Login.aspx";
                    window.location.href = LoadingUrl;
                }
            };

        </script>
        <script type="text/javascript">



            $(document).on('shown.lte.pushmenu', function () {
                var timeoutID;
                function delayedStart() {
                    timeoutID = window.setTimeout(resizeAction, 350);
                }

                function resizeAction() {
                    sidebarFn(1);
                    //  alert("Sidebar is collapsed or expanded!")
                    window.clearTimeout(timeoutID);
                }

                delayedStart();

            }).on('collapsed.lte.pushmenu', function () {
                var timeoutID;
                function delayedStart() {
                    timeoutID = window.setTimeout(resizeAction, 350);
                }

                function resizeAction() {
                    sidebarFn(2);
                    //  alert("Sidebar is collapsed or expanded!")
                    window.clearTimeout(timeoutID);
                }

                delayedStart();
            });
            function  sidebarFn(val){

                //$$("gridRpt").resize();
                //$$("gridMain").resize();
                gridResize();
            }

            function SMToDateChange(e) {
                debugger;
                var frmdate = $$("FromDt").getText();
                var todate = $$("ToDt").getText();
                var sFrmDt = $$("ToDt").getText();
                var vAccDt = $("#HdnAccMnth").val();

                var bSucc = "1";

                if (frmdate == "") {
                    webix.message("From Date can't be empty", "warning", 800);
                    $("#LoadDIv").hide();
                    bSucc = "0";
                    return bSucc;
                }


                if (todate == "") {
                    webix.message("To Date can't be empty", "warning", 800);
                    $("#LoadDIv").hide();
                    bSucc = "0";
                    return bSucc;
                }

                frmdate = formatDate(frmdate);
                todate = formatDate(todate);
                var CurrDt = formatDate(vAccDt);

                $.ajax({
                    type: "POST",
                    url: "/Reports/FTDateValidation",
                    cache: false,
                    async: false,
                    charset: 'utf-8',
                    data: "F=" +  frmdate + "&T=" + todate,
                    success: function (data) {
                        if (data.d != "") {
                            debugger;
                            //webix.message("From Month Should be less than To Month ", "warning", 500);
                            $("#LoadDIv").hide();
                            //$$("ToMthDate").setValue(FrmMnth);
                            var vToDt = formatDate1(sFrmDt);
                            $$("FromDt").setValue(new Date(vToDt));
                            //bSucc = "0";
                        }
                    }
                });


                $.ajax({
                    type: "POST",
                    url: "/Reports/FTDateValidation",
                    cache: false,
                    async: false,
                    charset: 'utf-8',
                    data: "F=" + todate  + "&T=" + CurrDt,
                    success: function (data) {
                        if (data.d != "") {
                            debugger;
                            //webix.message("From Month Should be less than To Month ", "warning", 500);
                            $("#LoadDIv").hide();
                            $$("ToDt").setValue(new Date(vAccDt));
                            //bSucc = "0";
                        }
                    }
                });


            };


            function SMFromDateChange(e) {
                debugger;
                var frmdate = $$("FromDt").getText();
                ///var todate = $$("ToDt").getText();
                var sFrmDt = $$("FromDt").getText();
                var vAccDt = $("#HdnAccMnth").val();

                var bSucc = "1";

                if (frmdate == "") {
                    webix.message("For Date can't be empty", "warning", 800);
                    $("#LoadDIv").hide();
                    bSucc = "0";
                    return bSucc;
                }



                $.ajax({
                    type: "POST",
                    url: "/Reports/FTDateValidation",
                    cache: false,
                    async: false,
                    charset: 'utf-8',
                    data: "F=" +  frmdate  + "&T=" +  vAccDt,
                    success: function (data) {
                        if (data.d != "") {
                            debugger;
                            //webix.message("From Month Should be less than To Month ", "warning", 500);
                            $("#LoadDIv").hide();
                            //$$("FromDt").setValue(vAccDt);
                            var vFromDt = formatDate1(vAccDt);
                            $$("FromDt").setValue(new Date(vFromDt));


                            //bSucc = "0";
                        }
                    }
                });

            };

            function SMToDateChange(e) {
                debugger;
                var frmdate = $$("FromDt").getText();
                var todate = $$("ToDt").getText();
                var sFrmDt = $$("ToDt").getText();
                var vAccDt = $("#HdnAccMnth").val();

                var bSucc = "1";



                if (frmdate == "") {
                    //webix.message("From Date can't be empty", "warning", 800);
                    $("#LoadDIv").hide();
                    bSucc = "0";
                    return false;
                }


                if (todate == "") {
                    //webix.message("To Date can't be empty", "warning", 800);
                    $("#LoadDIv").hide();
                    bSucc = "0";
                    return false;
                }

                frmdate = formatDate(frmdate);
                todate = formatDate(todate);
                var CurrDt = formatDate(vAccDt);

                $.ajax({
                    type: "POST",
                    url: "/Reports/FTDateValidation",
                    cache: false,
                    async: false,
                    charset: 'utf-8',
                    data: "F=" +  frmdate + "&T=" + todate,
                    success: function (data) {
                        if (data.d != "") {
                            debugger;
                            //webix.message("From Month Should be less than To Month ", "warning", 500);
                            $("#LoadDIv").hide();
                            //$$("ToMthDate").setValue(FrmMnth);
                            //var vToDt = formatDate(sFrmDt);
                            $$("FromDt").setValue(sFrmDt);
                            bSucc = "0";

                        }
                    }
                });

                if(bSucc=="0") return false;


                $.ajax({
                    type: "POST",
                    url: "/Reports/FTDateValidation",
                    cache: false,
                    async: false,
                    charset: 'utf-8',
                    data: "F=" +  todate  + "&T=" +  CurrDt,
                    success: function (data) {
                        if (data.d != "") {
                            debugger;
                            //webix.message("From Month Should be less than To Month ", "warning", 500);
                            $("#LoadDIv").hide();
                            //$$("FromDt").setValue(vAccDt);
                            $$("ToDt").setValue(vAccDt);
                            bSucc = "0";
                        }
                    }
                });

                if(bSucc=="0") return false;
                fnHeader();

            };


            function SMFromDateChange(e) {
                debugger;
                var frmdate = $$("FromDt").getValue();
                var todate = $$("ToDt").getValue();
                var sFrmDt = $$("FromDt").getValue();
                var vAccDt = $("#HdnAccMnth").val();

                var bSucc = "1";

                if (frmdate == "") {
                    //webix.message("From Date can't be empty", "warning", 800);
                    $("#LoadDIv").hide();
                    bSucc = "0";
                    return false;
                }


                if (todate == "") {
                    //webix.message("To Date can't be empty", "warning", 800);
                    $("#LoadDIv").hide();
                    bSucc = "0";
                    return false;
                }

                frmdate = formatDate(frmdate);
                todate = formatDate(todate);
                var CurrDt = formatDate(vAccDt);

                $.ajax({
                    type: "POST",
                    url: "/Reports/FTDateValidation",
                    cache: false,
                    async: false,
                    charset: 'utf-8',
                    data: "F=" + frmdate + "&T=" + todate,
                    success: function (data) {
                        if (data.d != "") {
                            debugger;
                            //webix.message("From Month Should be less than To Month ", "warning", 500);
                            $("#LoadDIv").hide();
                            //$$("ToMthDate").setValue(FrmMnth);
                            $$("ToDt").setValue(sFrmDt);
                            bSucc = "0";
                        }
                    }
                });
                if(bSucc=="0") return false;


                $.ajax({
                    type: "POST",
                    url: "/Reports/FTDateValidation",
                    cache: false,
                    async: false,
                    charset: 'utf-8',
                    data: "F=" +  frmdate  + "&T=" +  CurrDt,
                    success: function (data) {
                        if (data.d != "") {
                            debugger;
                            //webix.message("From Month Should be less than To Month ", "warning", 500);
                            $("#LoadDIv").hide();

                            $$("FromDt").setValue(new Date(vAccDt));
                            bSucc = "0";
                        }
                    }
                });

                if(bSucc=="0") return false;

                fnHeader();


            };

        </script>
    </section>
</div>